<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MC Pro Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para traducir JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons (Librería Base) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Estilos base y animaciones */
        body { font-family: 'Inter', sans-serif; background-color: #fcfcfc; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-in { animation: fadeIn 0.5s ease-out forwards; }
        
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .slide-in-from-bottom-5 { animation: slideUp 0.5s ease-out forwards; }
        
        @keyframes zoomIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .zoom-in { animation: zoomIn 0.3s ease-out forwards; }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- ADAPTADOR DE ICONOS LUCIDE PARA HTML ---
        // Esto convierte los iconos de la librería global 'lucide' en componentes de React
        const LucideIcon = ({ name, className, ...props }) => {
            const iconData = window.lucide.icons[name];
            if (!iconData) return null;

            return React.createElement(
                'svg',
                {
                    ...iconData.attrs,
                    ...props,
                    className: `lucide lucide-${name.toLowerCase()} ${className || ''}`
                },
                iconData.children?.map((child, index) => 
                    React.createElement(child.tag, { ...child.attrs, key: index })
                )
            );
        };

        // Mapeo de los iconos usados en tu código original
        const Calculator = (props) => <LucideIcon name="Calculator" {...props} />;
        const Package = (props) => <LucideIcon name="Package" {...props} />;
        const CalendarIcon = (props) => <LucideIcon name="Calendar" {...props} />; // Renombrado como en tu código
        const ClipboardList = (props) => <LucideIcon name="ClipboardList" {...props} />;
        const Palette = (props) => <LucideIcon name="Palette" {...props} />;
        const Plus = (props) => <LucideIcon name="Plus" {...props} />;
        const Trash2 = (props) => <LucideIcon name="Trash2" {...props} />;
        const Clock = (props) => <LucideIcon name="Clock" {...props} />;
        const MapPin = (props) => <LucideIcon name="MapPin" {...props} />;
        const BarChart3 = (props) => <LucideIcon name="BarChart3" {...props} />;
        const BookOpen = (props) => <LucideIcon name="BookOpen" {...props} />;
        const Users = (props) => <LucideIcon name="Users" {...props} />;
        const DollarSign = (props) => <LucideIcon name="DollarSign" {...props} />;
        const CheckCircle2 = (props) => <LucideIcon name="CheckCircle2" {...props} />;
        const AlertCircle = (props) => <LucideIcon name="AlertCircle" {...props} />;
        const Edit2 = (props) => <LucideIcon name="Edit2" {...props} />;
        const X = (props) => <LucideIcon name="X" {...props} />;
        const Star = (props) => <LucideIcon name="Star" {...props} />;
        const Zap = (props) => <LucideIcon name="Zap" {...props} />;
        const Instagram = (props) => <LucideIcon name="Instagram" {...props} />;
        const MessageCircle = (props) => <LucideIcon name="MessageCircle" {...props} />;
        const StickyNote = (props) => <LucideIcon name="StickyNote" {...props} />;
        const UserCheck = (props) => <LucideIcon name="UserCheck" {...props} />;
        const Layout = (props) => <LucideIcon name="Layout" {...props} />;
        const Gift = (props) => <LucideIcon name="Gift" {...props} />;
        const Sun = (props) => <LucideIcon name="Sun" {...props} />;
        const ChevronLeft = (props) => <LucideIcon name="ChevronLeft" {...props} />;
        const ChevronRight = (props) => <LucideIcon name="ChevronRight" {...props} />;
        const Save = (props) => <LucideIcon name="Save" {...props} />;
        const Menu = (props) => <LucideIcon name="Menu" {...props} />;
        const TrendingUp = (props) => <LucideIcon name="TrendingUp" {...props} />;
        const CloudSun = (props) => <LucideIcon name="CloudSun" {...props} />;
        const Globe = (props) => <LucideIcon name="Globe" {...props} />;
        const Truck = (props) => <LucideIcon name="Truck" {...props} />;
        const Wallet = (props) => <LucideIcon name="Wallet" {...props} />;
        const TrendingDown = (props) => <LucideIcon name="TrendingDown" {...props} />;
        const CreditCard = (props) => <LucideIcon name="CreditCard" {...props} />;
        const ArrowUpCircle = (props) => <LucideIcon name="ArrowUpCircle" {...props} />;
        const ArrowDownCircle = (props) => <LucideIcon name="ArrowDownCircle" {...props} />;
        const Lightbulb = (props) => <LucideIcon name="Lightbulb" {...props} />;
        const Sparkles = (props) => <LucideIcon name="Sparkles" {...props} />;
        const Box = (props) => <LucideIcon name="Box" {...props} />;
        const Scissors = (props) => <LucideIcon name="Scissors" {...props} />;
        const FileText = (props) => <LucideIcon name="FileText" {...props} />;
        const Printer = (props) => <LucideIcon name="Printer" {...props} />;
        const PlusCircle = (props) => <LucideIcon name="PlusCircle" {...props} />;
        const MinusCircle = (props) => <LucideIcon name="MinusCircle" {...props} />;
        const FileCheck = (props) => <LucideIcon name="FileCheck" {...props} />;
        const Mail = (props) => <LucideIcon name="Mail" {...props} />;
        const Download = (props) => <LucideIcon name="Download" {...props} />;
        const Lock = (props) => <LucideIcon name="Lock" {...props} />;
        const Key = (props) => <LucideIcon name="Key" {...props} />;
        const LogOut = (props) => <LucideIcon name="LogOut" {...props} />;

        // --- HOOK PARA PERSISTENCIA ---
        const usePersistedState = (key, defaultValue) => {
          const [state, setState] = useState(() => {
            try {
              const saved = localStorage.getItem(key);
              return saved ? JSON.parse(saved) : defaultValue;
            } catch (e) {
              return defaultValue;
            }
          });

          useEffect(() => {
            localStorage.setItem(key, JSON.stringify(state));
          }, [key, state]);

          return [state, setState];
        };

        // --- APP COMPONENT ---
        const App = () => {
          // --- ESTADOS DE AUTENTICACIÓN ---
          const [isAuthenticated, setIsAuthenticated] = usePersistedState('mc_auth_session', false);
          const [licenseInput, setLicenseInput] = useState('');
          const [authError, setAuthError] = useState('');

          // --- ESTADOS ---
          const [activeTab, setActiveTab] = useState('dashboard');
          const [showContactModal, setShowContactModal] = useState(false);
          const [notification, setNotification] = useState(null);
          const [currentTime, setCurrentTime] = useState(new Date());
          const [isSidebarOpen, setIsSidebarOpen] = useState(false);
          
          // --- NUEVO: DETECCIÓN DE PAÍS ---
          const [userCountry, setUserCountry] = usePersistedState('mc_country', 'UY');
          
          useEffect(() => {
            // Detección automática basada en la zona horaria del navegador
            const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            if (timeZone.includes('Argentina')) setUserCountry('AR');
            else if (timeZone.includes('Santiago')) setUserCountry('CL');
            else if (timeZone.includes('Mexico')) setUserCountry('MX');
            else if (timeZone.includes('Bogota')) setUserCountry('CO');
            else if (timeZone.includes('Madrid')) setUserCountry('ES');
            else if (timeZone.includes('Montevideo')) setUserCountry('UY');
            // Mantiene UY por defecto si no coincide con los anteriores
          }, []);

          const countryNames = {
            'UY': 'Uruguay',
            'AR': 'Argentina',
            'CL': 'Chile',
            'MX': 'México',
            'CO': 'Colombia',
            'ES': 'España',
            'INT': 'Internacional'
          };
          
          // Estados de edición simples
          const [editingClient, setEditingClient] = useState(null);
          const [editingTask, setEditingTask] = useState(null);
          const [editingInv, setEditingInv] = useState(null);
          const [editingShipment, setEditingShipment] = useState(null);
          const [editingExpense, setEditingExpense] = useState(null);
          const [editingIncome, setEditingIncome] = useState(null);
          
          // Calendario
          const [viewDate, setViewDate] = useState(new Date());
          const [selectedDay, setSelectedDay] = useState(new Date().getDate());

          // Datos Persistentes
          const [inventory, setInventory] = usePersistedState('mc_inventory', []);
          const [tasks, setTasks] = usePersistedState('mc_tasks', []);
          const [clients, setClients] = usePersistedState('mc_clients', []); 
          const [shipping, setShipping] = usePersistedState('mc_shipping', []);
          const [expenses, setExpenses] = usePersistedState('mc_expenses', []); 
          const [extraIncomes, setExtraIncomes] = usePersistedState('mc_extra_incomes', []); 
          const [personalEvents, setPersonalEvents] = usePersistedState('mc_personal_events', {});
          
          // --- NUEVO: ESTADOS PARA PRESUPUESTOS ---
          const [presupuestos, setPresupuestos] = usePersistedState('mc_presupuestos', []);
          const [isCreatingBudget, setIsCreatingBudget] = useState(false);
          const [currentBudget, setCurrentBudget] = useState({
            id: null,
            client: '',
            date: new Date().toISOString().split('T')[0],
            items: [{ id: Date.now(), desc: '', qty: 1, price: 0 }],
            status: 'Pendiente', // Pendiente, Aprobado, Rechazado
            notes: ''
          });

          // --- COTIZADOR PRO ---
          const [calc, setCalc] = usePersistedState('mc_calc_pro', { 
            materialCost: 0,
            wastePercent: 10,
            packagingCost: 0,
            designHours: 0,
            productionHours: 0,
            hourlyRate: 0,
            fixedCosts: 0,
            margin: 50
          });

          // --- BASE DE DATOS DE FECHAS GLOBAL CM + REGIONAL (COMPLETA) ---
          const perpetualEvents = useMemo(() => [
            // ENERO
            { d: 1, m: 0, t: 'Año Nuevo', type: 'INT', info: 'Inicio de año.' },
            { d: 4, m: 0, t: 'Día del Braille', type: 'CM', info: 'Día Mundial del Braille.' },
            { d: 5, m: 0, t: 'Noche de Reyes', type: 'CM', info: 'Víspera de ilusión.' },
            { d: 6, m: 0, t: 'Día de Reyes', type: 'INT', info: 'Tradición de regalos.' },
            { d: 6, m: 0, t: 'Día de los Niños', type: 'UY', info: 'Tradicional Reyes en UY.' },
            { d: 14, m: 0, t: 'Día de la Cometa', type: 'CM', info: 'Contenido visual y lúdico.' },
            { d: 16, m: 0, t: 'Día de la Croqueta', type: 'CM', info: 'Tendencia gastronómica.' },
            { d: 19, m: 0, t: 'The Beatles Day', type: 'CM', info: 'Homenaje a la banda.' },
            { d: 24, m: 0, t: 'Día del Periodista', type: 'CM', info: 'Comunicación y ética.' },
            { d: 25, m: 0, t: 'Día de la Publicidad', type: 'CM', info: '¡Creatividad al máximo!' },
            { d: 26, m: 0, t: 'Ed. Ambiental', type: 'CM', info: 'Conciencia ecológica.' },
            { d: 28, m: 0, t: 'Protección de Datos', type: 'CM', info: 'Privacidad digital.' },
            { d: 30, m: 0, t: 'Día del Croissant', type: 'CM', info: 'Contenido Foodie.' },
            { d: 31, m: 0, t: 'Día del Mago', type: 'CM', info: 'Magia y asombro.' },

            // FEBRERO
            { d: 2, m: 1, t: 'Día del Galgo / Marmota', type: 'CM', info: 'Tendencia animal.' },
            { d: 3, m: 1, t: 'Día del Abogado', type: 'CM', info: 'Servicios legales.' },
            { d: 4, m: 1, t: 'Día Contra el Cáncer', type: 'CM', info: 'Conciencia social.' },
            { d: 5, m: 1, t: 'Hombre del Tiempo', type: 'CM', info: 'Meteorología.' },
            { d: 11, m: 1, t: 'Mujer en la Ciencia', type: 'CM', info: 'Inclusión y talento.' },
            { d: 12, m: 1, t: 'Carnaval', type: 'AR', info: 'Feriado de Carnaval.' }, 
            { d: 16, m: 1, t: 'Carnaval (Lunes)', type: 'UY', info: 'Feriado de Carnaval.' },
            { d: 17, m: 1, t: 'Carnaval (Martes)', type: 'UY', info: 'Feriado de Carnaval.' },
            { d: 13, m: 1, t: 'Día de la Radio', type: 'CM', info: 'Día Mundial de la Radio.' },
            { d: 14, m: 1, t: 'San Valentín', type: 'INT', info: 'Campaña de amor y regalos.' },
            { d: 20, m: 1, t: 'Día del Gato', type: 'INT', info: 'Contenido viral de mascotas.' },
            { d: 24, m: 1, t: 'Community Manager Day', type: 'CM', info: '¡Nuestro Gran Día!' },
            { d: 27, m: 1, t: 'Día de las ONG', type: 'CM', info: 'Compromiso social.' },
            { d: 28, m: 1, t: 'Enfermedades Raras', type: 'CM', info: 'Visibilidad médica.' },
            { d: 28, m: 1, t: 'Grito de Asencio', type: 'UY', info: 'Inicio Revolución Oriental.' },

            // MARZO
            { d: 3, m: 2, t: 'Vida Silvestre', type: 'CM', info: 'Día Mundial Naturaleza.' },
            { d: 4, m: 2, t: 'Día de la Obesidad', type: 'CM', info: 'Salud y nutrición.' },
            { d: 5, m: 2, t: 'Eficiencia Energética', type: 'CM', info: 'Sustentabilidad.' },
            { d: 8, m: 2, t: 'Día de la Mujer', type: 'INT', info: 'Fuerza y equidad.' },
            { d: 14, m: 2, t: 'Día del Número Pi', type: 'CM', info: 'Contenido matemático.' },
            { d: 15, m: 2, t: 'Día del Consumidor', type: 'CM', info: 'Atención al cliente.' },
            { d: 17, m: 2, t: 'San Patricio', type: 'INT', info: 'Campaña de color verde.' },
            { d: 19, m: 2, t: 'Día de José Pedro Varela', type: 'UY', info: 'Reforma Educativa.' },
            { d: 20, m: 2, t: 'Día de la Felicidad', type: 'CM', info: 'Positivismo en redes.' },
            { d: 21, m: 2, t: 'Poesía / Down', type: 'CM', info: 'Inclusión y cultura.' },
            { d: 22, m: 2, t: 'Día del Agua', type: 'CM', info: 'Recurso vital.' },
            { d: 23, m: 2, t: 'Meteorológica', type: 'CM', info: 'Día Mundial.' },
            { d: 24, m: 2, t: 'Día de la Memoria', type: 'AR', info: 'Verdad y Justicia.' },
            { d: 26, m: 2, t: 'Día del Clima', type: 'CM', info: 'Cambio climático.' },
            { d: 27, m: 2, t: 'Día del Teatro', type: 'CM', info: 'Artes escénicas.' },
            { d: 31, m: 2, t: 'Día del Queso', type: 'CM', info: 'Gastronomía.' },

            // ABRIL
            { d: 1, m: 3, t: 'Diversión en el Trabajo', type: 'CM', info: 'Clima laboral.' },
            { d: 2, m: 3, t: 'Semana de Turismo (Jueves)', type: 'UY', info: 'Jueves Santo.' },
            { d: 3, m: 3, t: 'Semana de Turismo (Viernes)', type: 'UY', info: 'Viernes Santo.' },
            { d: 2, m: 3, t: 'Libro Infantil', type: 'CM', info: 'Literatura para niños.' },
            { d: 2, m: 3, t: 'Veterano y Caídos', type: 'AR', info: 'Malvinas Argentinas.' },
            { d: 6, m: 3, t: 'Día del Deporte', type: 'CM', info: 'Actividad física.' },
            { d: 7, m: 3, t: 'Día de la Salud', type: 'CM', info: 'Bienestar mundial.' },
            { d: 11, m: 3, t: 'Día del Parkinson', type: 'CM', info: 'Salud mental.' },
            { d: 13, m: 3, t: 'Día del Beso', type: 'CM', info: 'Campaña romántica.' },
            { d: 15, m: 3, t: 'Día del Arte', type: 'INT', info: 'Estética y diseño.' },
            { d: 17, m: 3, t: 'Día de los Simpson', type: 'CM', info: 'Cultura pop.' },
            { d: 19, m: 3, t: 'Desembarco de los 33', type: 'UY', info: 'Cruzada Libertadora.' },
            { d: 21, m: 3, t: 'Creatividad', type: 'CM', info: 'Día Mundial.' },
            { d: 22, m: 3, t: 'Día de la Tierra', type: 'INT', info: 'Eco-branding.' },
            { d: 23, m: 3, t: 'Día del Libro', type: 'INT', info: 'Storytelling y lectura.' },
            { d: 26, m: 3, t: 'Propiedad Intelectual', type: 'CM', info: 'Derechos de autor.' },
            { d: 27, m: 3, t: 'Diseño Gráfico', type: 'CM', info: '¡Celebración visual!' },
            { d: 29, m: 3, t: 'Día de la Danza', type: 'CM', info: 'Movimiento y ritmo.' },
            { d: 30, m: 3, t: 'Día del Jazz', type: 'CM', info: 'Cultura musical.' },

            // MAYO
            { d: 1, m: 4, t: 'Día del Trabajador', type: 'INT', info: 'Feriado Internacional.' },
            { d: 2, m: 4, t: 'Contra el Bullying', type: 'CM', info: 'Conciencia escolar.' },
            { d: 3, m: 4, t: 'Libertad de Prensa', type: 'CM', info: 'Información libre.' },
            { d: 4, m: 4, t: 'Star Wars Day', type: 'CM', info: 'May the 4th be with you.' },
            { d: 8, m: 4, t: 'Día Cruz Roja', type: 'CM', info: 'Humanidad.' },
            { d: 12, m: 4, t: 'Día Enfermería', type: 'CM', info: 'Homenaje.' },
            { d: 15, m: 4, t: 'Día Familia', type: 'CM', info: 'Vínculos.' },
            { d: 17, m: 4, t: 'Día de Internet', type: 'CM', info: '¡Cultura digital!' },
            { d: 18, m: 4, t: 'Batalla de las Piedras', type: 'UY', info: 'Primera victoria oriental.' },
            { d: 20, m: 4, t: 'Día de las Abejas', type: 'CM', info: 'Naturaleza.' },
            { d: 22, m: 4, t: 'Biodiversidad', type: 'CM', info: 'Medio ambiente.' },
            { d: 25, m: 4, t: 'Revolución de Mayo', type: 'AR', info: 'Día Patrio Argentina.' },
            { d: 25, m: 4, t: 'Orgullo Geek', type: 'CM', info: 'Homenaje a la cultura geek.' },
            { d: 26, m: 4, t: 'Día Nacional del Libro', type: 'UY', info: 'Fundación Biblioteca Nacional.' },
            { d: 28, m: 4, t: 'Día de la Hamburguesa', type: 'CM', info: 'Trending Food.' },
            { d: 30, m: 4, t: 'Esclerosis Múltiple', type: 'CM', info: 'Salud.' },
            { d: 31, m: 4, t: 'Día Sin Tabaco', type: 'CM', info: 'Vida sana.' },

            // JUNIO
            { d: 3, m: 5, t: 'Día de la Bicicleta', type: 'CM', info: 'Sustentabilidad.' },
            { d: 5, m: 5, t: 'Medio Ambiente', type: 'INT', info: 'Día Mundial.' },
            { d: 8, m: 5, t: 'Día de los Océanos', type: 'CM', info: 'Preservación marina.' },
            { d: 12, m: 5, t: 'Contra Trabajo Infantil', type: 'CM', info: 'Derechos niños.' },
            { d: 14, m: 5, t: 'Donante Sangre', type: 'CM', info: 'Solidaridad.' },
            { d: 17, m: 5, t: 'Muerte de Güemes', type: 'AR', info: 'Héroe Nacional.' },
            { d: 18, m: 5, t: 'Día del Sushi', type: 'CM', info: 'Gastronomía viral.' },
            { d: 19, m: 5, t: 'Natalicio de Artigas', type: 'UY', info: 'Día del Abuelo en Uruguay.' },
            { d: 20, m: 5, t: 'Día de la Bandera', type: 'AR', info: 'Manuel Belgrano.' },
            { d: 20, m: 5, t: 'Refugiado / Yellow Day', type: 'CM', info: 'Día más feliz del año.' },
            { d: 21, m: 5, t: 'Selfie / Yoga / Sol', type: 'CM', info: 'Solsticio y tendencias.' },
            { d: 28, m: 5, t: 'Día del Orgullo', type: 'INT', info: 'Diversidad y respeto.' },
            { d: 30, m: 5, t: 'Redes Sociales', type: 'CM', info: 'Social Media Day.' },

            // JULIO
            { d: 1, m: 6, t: 'Día del Reggae', type: 'CM', info: 'Música y cultura.' },
            { d: 3, m: 6, t: 'Sin Bolsas Plástico', type: 'CM', info: 'Ecología.' },
            { d: 4, m: 6, t: 'Independencia EEUU', type: 'CM', info: 'Contenido global.' },
            { d: 9, m: 6, t: 'Día de la Independencia', type: 'AR', info: 'Fiesta Patria Argentina.' },
            { d: 11, m: 6, t: 'Día Población', type: 'CM', info: 'Estadísticas mundiales.' },
            { d: 13, m: 6, t: 'Día Mundial del Rock', type: 'CM', info: 'Playlist y actitud.' },
            { d: 17, m: 6, t: 'Día del Emoji', type: 'CM', info: '¡Comunicación visual!' },
            { d: 18, m: 6, t: 'Jura Constitución', type: 'UY', info: 'Feriado Patrio Uruguay.' },
            { d: 21, m: 6, t: 'Día del Perro', type: 'CM', info: 'Mascotas y ternura.' },
            { d: 26, m: 6, t: 'Día de los Abuelos', type: 'INT', info: 'Homenaje familiar.' },
            { d: 30, m: 6, t: 'Día de la Amistad', type: 'INT', info: 'Campaña compartida.' },

            // AGOSTO
            { d: 1, m: 7, t: 'Día de la Alegría', type: 'CM', info: 'Contenido positivo.' },
            { d: 8, m: 7, t: 'Día del Gato', type: 'INT', info: 'Trending videos.' },
            { d: 12, m: 7, t: 'Día de la Juventud', type: 'CM', info: 'Futuro y energía.' },
            { d: 13, m: 7, t: 'Día de los Zurdos', type: 'CM', info: 'Curiosidades.' },
            { d: 15, m: 7, t: 'Día Relajación', type: 'CM', info: 'Wellness.' },
            { d: 17, m: 7, t: 'Paso a la Inmortalidad de San Martín', type: 'AR', info: 'Libertador de América.' },
            { d: 19, m: 7, t: 'Día Fotografía', type: 'CM', info: 'Estética y captura.' },
            { d: 23, m: 7, t: 'Hashtag Day', type: 'CM', info: 'Historia de las etiquetas.' },
            { d: 24, m: 7, t: 'Noche Nostalgia', type: 'UY', info: 'Celebración tradicional UY.' },
            { d: 25, m: 7, t: 'Independencia UY', type: 'UY', info: 'Feriado Nacional Uruguay.' },
            { d: 29, m: 7, t: 'Día del Videojuego', type: 'CM', info: 'Gaming culture.' },

            // SEPTIEMBRE
            { d: 1, m: 8, t: 'Día del GIF', type: 'CM', info: 'Contenido dinámico.' },
            { d: 8, m: 8, t: 'Alfabetización', type: 'CM', info: 'Educación.' },
            { d: 11, m: 8, t: 'Día del Maestro', type: 'AR', info: 'Sarmiento.' },
            { d: 13, m: 8, t: 'Chocolate / Programador', type: 'CM', info: 'Foodie & Tech.' },
            { d: 15, m: 8, t: 'Día Democracia', type: 'CM', info: 'Institucional.' },
            { d: 16, m: 8, t: 'Capa de Ozono', type: 'CM', info: 'Planeta.' },
            { d: 21, m: 8, t: 'Día del Estudiante', type: 'AR', info: 'Primavera y estudiantes.' },
            { d: 21, m: 8, t: 'Paz / Primavera', type: 'UY', info: 'Día del Estudiante en UY.' },
            { d: 22, m: 8, t: 'Podcast / Sin Coches', type: 'CM', info: 'Audio marketing.' },
            { d: 23, m: 8, t: 'Fallecimiento de Artigas', type: 'UY', info: 'Homenaje al Prócer.' },
            { d: 27, m: 8, t: 'Día del Turismo', type: 'CM', info: 'Viajes.' },
            { d: 30, m: 8, t: 'Día Traducción', type: 'CM', info: 'Idiomas.' },

            // OCTUBRE
            { d: 1, m: 9, t: 'Día del Café', type: 'CM', info: 'Posteo matutino.' },
            { d: 2, m: 9, t: 'No Violencia', type: 'CM', info: 'Respeto.' },
            { d: 4, m: 9, t: 'Día Animales', type: 'INT', info: 'Fauna silvestre.' },
            { d: 5, m: 9, t: 'Día Docentes', type: 'CM', info: 'Homenaje maestros.' },
            { d: 9, m: 9, t: 'Día del Correo', type: 'CM', info: 'Logística y cartas.' },
            { d: 10, m: 9, t: 'Salud Mental', type: 'CM', info: 'Autocuidado.' },
            { d: 12, m: 9, t: 'Diversidad Cultural', type: 'INT', info: 'Feriado Regional.' },
            { d: 12, m: 9, t: 'Batalla de Sarandí', type: 'UY', info: 'Hito histórico oriental.' },
            { d: 16, m: 9, t: 'Día Alimentación', type: 'CM', info: 'Nutrición.' },
            { d: 19, m: 9, t: 'Cáncer de Mama', type: 'INT', info: 'Lazo rosa.' },
            { d: 24, m: 9, t: 'Día Biblioteca', type: 'CM', info: 'Libros y cultura.' },
            { d: 28, m: 9, t: 'Día Animación', type: 'CM', info: 'Motion graphics.' },
            { d: 31, m: 9, t: 'Halloween', type: 'INT', info: 'Terror y creatividad.' },

            // NOVIEMBRE
            { d: 1, m: 10, t: 'Todos los Santos', type: 'INT', info: 'Tradición religiosa.' },
            { d: 2, m: 10, t: 'Día de los Difuntos', type: 'UY', info: 'Feriado en Uruguay.' },
            { d: 11, m: 10, t: 'Librerías / Sin Wifi', type: 'CM', info: 'Contenido off-line.' },
            { d: 14, m: 10, t: 'Diabetes', type: 'CM', info: 'Salud preventiva.' },
            { d: 16, m: 10, t: 'Patrimonio', type: 'CM', info: 'Cultura histórica.' },
            { d: 19, m: 10, t: 'Mujer Emprendedora / Hombre', type: 'CM', info: 'Liderazgo.' },
            { d: 20, m: 10, t: 'Soberanía Nacional', type: 'AR', info: 'Batalla Vuelta de Obligado.' },
            { d: 20, m: 10, t: 'Universal del Niño', type: 'CM', info: 'Derechos infantiles.' },
            { d: 21, m: 10, t: 'Televisión / Música', type: 'CM', info: 'Medios y ritmo.' },
            { d: 30, m: 10, t: 'Influencer Day', type: 'CM', info: 'Creadores de contenido.' },

            // DICIEMBRE
            { d: 8, m: 11, t: 'Día de la Virgen', type: 'INT', info: 'Feriado Inmaculada Concepción.' },
            { d: 8, m: 11, t: 'Día de las Playas', type: 'UY', info: 'Inicio de temporada estival.' },
            { d: 10, m: 11, t: 'Derechos Humanos', type: 'INT', info: 'Igualdad.' },
            { d: 18, m: 11, t: 'Día del Migrante', type: 'CM', info: 'Historias de vida.' },
            { d: 20, m: 11, t: 'Solidaridad', type: 'CM', info: 'Apoyo mutuo.' },
            { d: 22, m: 11, t: 'Día de Lotería', type: 'CM', info: 'Suerte y fin de año.' },
            { d: 24, m: 11, t: 'Nochebuena', type: 'INT', info: 'Engagement familiar.' },
            { d: 25, m: 11, t: 'Navidad', type: 'INT', info: 'Celebración Mundial.' },
            { d: 25, m: 11, t: 'Día de la Familia', type: 'UY', info: 'Nombre oficial en Uruguay.' },
            { d: 31, m: 11, t: 'Fin de Año', type: 'INT', info: 'Brindis y metas 2027.' }
          ], []);

          // --- BASE DE DATOS DE IDEAS Y TENDENCIAS ---
          const seasonalStrategies = useMemo(() => [
            { m: 0, title: 'Vuelta a Clases', ideas: ['Etiquetas escolares resistentes al agua', 'Cuadernos de tapa dura', 'Planner para maestros', 'Calendarios magnéticos'], trend: 'Colores primarios y texturas mate.' },
            { m: 1, title: 'San Valentín', ideas: ['Explosion boxes fotográficas', 'Tarjetas con foil', 'Packaging premium', 'Cuponeras del amor'], trend: 'Rojos, rosas y troquelados.' },
            { m: 2, title: 'Mes de la Mujer', ideas: ['Agendas emprendedoras', 'Libretas motivadoras', 'Packaging floral', 'Bookmarks artesanales'], trend: 'Acuarelas y tonos lavanda.' },
            { m: 3, title: 'Pascua / Otoño', ideas: ['Bolsas de conejo', 'Tags pascuales', 'Kits decoración', 'Invitaciones rústicas'], trend: 'Tonos tierra y Kraft.' },
            { m: 4, title: 'Día de la Madre', ideas: ['Álbumes Scrapbook', 'Cajas con visor', 'Marcos de papel', 'Tarjetas Pop-up'], trend: 'Foil dorado y flores.' },
            { m: 5, title: 'Día del Padre', ideas: ['Packaging botellas', 'Organizadores mesa', 'Tarjetas herramientas', 'Cuadernos cuero'], trend: 'Maderas y azul navy.' },
            { m: 6, title: 'Día del Niño', ideas: ['Libros colorear', 'Kits de stickers', 'Cajas juegos', 'Party boxes'], trend: 'Neon y divertidos.' },
            { m: 7, title: 'Independencia / Nostalgia', ideas: ['Papelería patriótica', 'Invitaciones retro', 'Menús época', 'Banderines'], trend: 'Celeste, blanco y dorado.' },
            { m: 8, title: 'Primavera / Picnic', ideas: ['Platos decorados', 'Packaging souvenirs', 'Diarios naturaleza', 'Tags flores'], trend: 'Multicolor floral.' },
            { m: 9, title: 'Halloween', ideas: ['Bolsas dulces', 'Invitaciones sangre', 'Decoración 3D', 'Stickers glow'], trend: 'Naranja, negro y morado.' },
            { m: 10, title: 'Bodas / Eventos', ideas: ['Libros de firmas', 'Recordatorios láser', 'Menús elegantes', 'Cajas arroz'], trend: 'Blanco perla y organza.' },
            { m: 11, title: 'Navidad / Año Nuevo', ideas: ['Tags regalos', 'Calendarios adviento', 'Cajas pan dulce', 'Agendas 2027'], trend: 'Verde pino y glitter.' }
          ], []);

          // --- LÓGICA DE TEMAS ---
          const themeData = useMemo(() => {
            const month = currentTime.getMonth();
            const seasons = { Verano: [11, 0, 1], Otoño: [2, 3, 4], Invierno: [5, 6, 7], Primavera: [8, 9, 10] };
            const season = Object.keys(seasons).find(key => seasons[key].includes(month));
            const seasonalPalettes = {
              'Verano': ['#FFD700', '#FF8C00', '#00BFFF', '#FFFFFF'],
              'Otoño': ['#8B4513', '#D35400', '#CD853F', '#FAF3E0'],
              'Invierno': ['#191970', '#4169E1', '#87CEEB', '#F0F8FF'],
              'Primavera': ['#FF69B4', '#32CD32', '#BA68C8', '#FFF0F5']
            };
            const campaignPalettes = {
              'Vuelta a Clases': ['#E11D48', '#FFD700', '#2563EB', '#10B981'],
              'San Valentín': ['#E11D48', '#FB7185', '#F43F5E', '#881337'],
              'Mes de la Mujer': ['#7C3AED', '#A78BFA', '#C084FC', '#4C1D95'],
              'Campaña Creativa': ['#F472B6', '#60A5FA', '#34D399', '#FBBF24']
            };
            const campaign = month === 0 ? 'Vuelta a Clases' : month === 1 ? 'San Valentín' : month === 2 ? 'Mes de la Mujer' : 'Campaña Creativa';
            return {
              seasonName: season,
              campaignName: campaign,
              seasonalPalette: seasonalPalettes[season] || seasonalPalettes['Verano'],
              campaignPalette: campaignPalettes[campaign] || campaignPalettes['Campaña Creativa'],
              primaryColor: (campaignPalettes[campaign] || campaignPalettes['Campaña Creativa'])[0],
              strategies: seasonalStrategies.find(s => s.m === month)
            };
          }, [currentTime, seasonalStrategies]);

          // --- RELOJ ---
          useEffect(() => {
            const timer = setInterval(() => setCurrentTime(new Date()), 1000);
            return () => clearInterval(timer);
          }, []);

          const notify = (msg) => {
            setNotification(msg);
            setTimeout(() => setNotification(null), 2500);
          };

          const deleteItem = (id, setter, entityName) => {
            setter(prev => prev.filter(item => item.id !== id));
            notify(`${entityName} eliminado`);
          };

          const saveEntity = (e, entitySet, currentEntity, setter, entityName) => {
            e.preventDefault();
            const f = new FormData(e.target);
            const data = Object.fromEntries(f.entries());
            if (data.amount) data.amount = Number(data.amount);
            if (data.qty) data.qty = Number(data.qty);
            if (data.price) data.price = Number(data.price);
            const newItem = { id: currentEntity?.id || Date.now(), ...data, date: currentEntity?.date || new Date().toISOString().split('T')[0], completed: currentEntity?.completed || false };
            entitySet(prev => currentEntity ? prev.map(c => c.id === currentEntity.id ? newItem : c) : [...prev, newItem]);
            setter(null); e.target.reset(); notify(`${entityName} guardado`);
          };

          // --- LOGICA EXPORTAR A CSV ---
          const exportToCSV = (data, filename) => {
            if (!data || data.length === 0) {
              notify("No hay datos para exportar");
              return;
            }
            
            // Obtener headers
            const headers = Object.keys(data[0]).join(",");
            
            // Formatear filas
            const rows = data.map(row => 
              Object.values(row).map(val => {
                if (typeof val === 'string') return `"${val.replace(/"/g, '""')}"`; // Escapar comillas dobles
                return val;
              }).join(",")
            );
            
            // Crear contenido CSV con BOM para soporte UTF-8 en Excel
            const csvContent = "\uFEFF" + [headers, ...rows].join("\n");
            
            // Crear blob y descargar
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", `${filename}_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          };

          // --- LOGICA LOGIN ---
          const handleLogin = (e) => {
            e.preventDefault();
            // CLAVE MAESTRA SIMULADA PARA SaaS
            if (licenseInput.trim().toUpperCase() === 'CREATIVO2026') {
              setIsAuthenticated(true);
              setAuthError('');
            } else {
              setAuthError('Licencia inválida. Contacta a soporte.');
            }
          };

          // --- LOGICA PRESUPUESTOS ---
          const handleBudgetChange = (field, value) => {
            setCurrentBudget(prev => ({ ...prev, [field]: value }));
          };

          const addBudgetItem = () => {
            setCurrentBudget(prev => ({
              ...prev,
              items: [...prev.items, { id: Date.now(), desc: '', qty: 1, price: 0 }]
            }));
          };

          const removeBudgetItem = (itemId) => {
            if (currentBudget.items.length === 1) return;
            setCurrentBudget(prev => ({
              ...prev,
              items: prev.items.filter(i => i.id !== itemId)
            }));
          };

          const updateBudgetItem = (itemId, field, value) => {
            setCurrentBudget(prev => ({
              ...prev,
              items: prev.items.map(i => i.id === itemId ? { ...i, [field]: value } : i)
            }));
          };

          const saveBudget = () => {
            if (!currentBudget.client) { notify("Falta nombre del cliente"); return; }
            
            if (currentBudget.id) {
              // Editar existente
              setPresupuestos(prev => prev.map(b => b.id === currentBudget.id ? currentBudget : b));
              notify("Presupuesto Actualizado");
            } else {
              // Crear nuevo
              setPresupuestos(prev => [...prev, { ...currentBudget, id: Date.now() }]);
              notify("Presupuesto Creado");
            }
            
            setIsCreatingBudget(false);
            resetBudgetForm();
          };

          const editBudget = (budget) => {
            setCurrentBudget(budget);
            setIsCreatingBudget(true);
          };

          const resetBudgetForm = () => {
            setCurrentBudget({
              id: null,
              client: '',
              date: new Date().toISOString().split('T')[0],
              items: [{ id: Date.now(), desc: '', qty: 1, price: 0 }],
              status: 'Pendiente',
              notes: ''
            });
          };

          const calculateBudgetTotal = (items) => {
            return items.reduce((acc, item) => acc + (Number(item.qty) * Number(item.price)), 0);
          };


          const totalIncomes = useMemo(() => clients.reduce((acc, c) => acc + (c.amount || 0), 0) + extraIncomes.reduce((acc, i) => acc + (i.amount || 0), 0), [clients, extraIncomes]);
          const totalExpenses = useMemo(() => expenses.reduce((acc, e) => acc + (e.amount || 0), 0), [expenses]);
          const netBalance = totalIncomes - totalExpenses;

          const calendarDays = useMemo(() => {
            const y = viewDate.getFullYear(), m = viewDate.getMonth();
            const dInM = new Date(y, m + 1, 0).getDate();
            const firstDay = new Date(y, m, 1).getDay();
            const offset = firstDay === 0 ? 6 : firstDay - 1;
            const days = [];
            for (let i = 0; i < offset; i++) days.push(null);
            for (let i = 1; i <= dInM; i++) days.push(i);
            return days;
          }, [viewDate]);

          const getDayKey = (d) => `${viewDate.getFullYear()}-${String(viewDate.getMonth() + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;

          const NavItem = ({ id, label, icon: Icon }) => (
            <button onClick={() => { setActiveTab(id); setIsSidebarOpen(false); }} className={`w-full flex items-center gap-4 px-4 py-3.5 rounded-2xl transition-all font-bold text-[13px] uppercase tracking-tight ${activeTab === id ? 'bg-[#E11D48] text-white shadow-lg' : 'text-slate-500 hover:bg-slate-50'}`}><Icon className="w-5 h-5" /> {label}</button>
          );

          // --- RENDERIZADO CONDICIONAL POR LOGIN ---
          if (!isAuthenticated) {
            return (
              <div className="flex h-screen items-center justify-center bg-slate-50 p-6">
                 <div className="w-full max-w-md bg-white p-10 rounded-[3rem] shadow-2xl border border-slate-100 text-center animate-in zoom-in duration-300">
                    <div className="p-4 rounded-3xl bg-[#E11D48] text-white shadow-xl inline-block mb-6 rotate-3">
                       <Star className="w-8 h-8 fill-current" />
                    </div>
                    <h1 className="text-3xl font-black text-slate-800 uppercase italic tracking-tighter mb-2">MC Pro</h1>
                    <p className="text-xs font-bold text-slate-400 uppercase tracking-[0.3em] mb-10">Acceso a Miembros</p>
                    
                    <form onSubmit={handleLogin} className="space-y-4">
                       <div className="bg-slate-50 p-4 rounded-2xl flex items-center gap-3 border border-slate-100 focus-within:border-[#E11D48] transition-colors">
                          <Key className="w-5 h-5 text-slate-400" />
                          <input 
                            type="password" 
                            placeholder="Licencia de Membresía" 
                            className="bg-transparent outline-none w-full font-bold text-slate-700"
                            value={licenseInput}
                            onChange={(e) => setLicenseInput(e.target.value)}
                          />
                       </div>
                       {authError && <p className="text-xs font-bold text-red-500">{authError}</p>}
                       <button type="submit" className="w-full py-4 bg-slate-900 text-white rounded-2xl font-black uppercase tracking-widest hover:bg-black transition-all shadow-lg flex items-center justify-center gap-2">
                          <Lock className="w-4 h-4" /> Ingresar
                       </button>
                    </form>
                    <p className="mt-8 text-[10px] text-slate-300 font-bold uppercase tracking-widest">Powered by Modo Creativo</p>
                 </div>
              </div>
            );
          }

          return (
            <div className="flex h-screen overflow-hidden bg-[#fcfcfc] text-slate-800 font-sans">
              
              {/* SIDEBAR */}
              <aside className={`fixed lg:static inset-y-0 left-0 w-72 bg-white border-r border-slate-100 flex flex-col shrink-0 shadow-2xl z-50 transition-transform duration-300 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}`}>
                <div className="p-8 text-center relative flex flex-col items-center">
                  <div className="p-3 rounded-2xl text-white shadow-xl rotate-3 mb-3 inline-block bg-[#E11D48]"><Star className="w-6 h-6 fill-current" /></div>
                  <h1 className="font-black text-2xl tracking-tighter uppercase italic text-slate-800">MC Pro</h1>
                  <p className="text-[10px] font-bold text-[#E11D48] uppercase tracking-[0.4em] mt-1">Modo Creativo</p>
                </div>
                <nav className="flex-1 p-6 space-y-1 overflow-y-auto">
                  <NavItem id="dashboard" label="Escritorio" icon={Layout} />
                  <NavItem id="strategies" label="Sugerencias & Ideas" icon={Lightbulb} />
                  <NavItem id="finances" label="Finanzas" icon={Wallet} />
                  <NavItem id="clients" label="Ventas & Cobros" icon={DollarSign} />
                  <NavItem id="presupuestos" label="Presupuestos" icon={FileText} />
                  <NavItem id="shipping" label="Envíos UY" icon={Truck} />
                  <NavItem id="planner" label="Calendario" icon={CalendarIcon} />
                  <NavItem id="inventory" label="Inventario" icon={Package} />
                  <NavItem id="checklist" label="Taller" icon={ClipboardList} />
                  <NavItem id="calculator" label="Cotizador Pro" icon={Calculator} />
                </nav>
                <div className="p-6 border-t border-slate-50 space-y-2">
                  <button onClick={() => setShowContactModal(true)} className="w-full flex items-center justify-center gap-2 py-4 bg-slate-900 text-white rounded-2xl font-bold text-[11px] uppercase tracking-widest hover:bg-black transition-all"><MessageCircle className="w-4 h-4" /> Soporte</button>
                  <button onClick={() => setIsAuthenticated(false)} className="w-full flex items-center justify-center gap-2 py-4 text-slate-400 hover:text-[#E11D48] rounded-2xl font-bold text-[11px] uppercase tracking-widest transition-all"><LogOut className="w-4 h-4" /> Salir</button>
                </div>
              </aside>

              {/* MAIN CONTENT */}
              <main className="flex-1 overflow-y-auto p-6 md:p-10 relative">
                {notification && <div className="fixed top-10 right-10 bg-slate-900 text-white px-8 py-4 rounded-2xl font-bold text-[12px] uppercase shadow-2xl z-[100] animate-in slide-in-from-top-4">{notification}</div>}

                <header className="flex justify-between items-center mb-12">
                  <button onClick={() => setIsSidebarOpen(true)} className="lg:hidden p-3 bg-white shadow-sm border border-slate-100 rounded-xl text-[#E11D48]"><Menu className="w-6 h-6" /></button>
                  <h2 className="text-4xl font-black tracking-tighter uppercase italic text-slate-800">
                    {activeTab === 'presupuestos' ? 'Presupuestos' : activeTab.replace('dashboard','Escritorio').replace('planner','Calendario').replace('checklist','Taller').replace('finances', 'Finanzas').replace('shipping', 'Envíos').replace('calculator', 'Cotizador Pro').replace('strategies', 'Estrategias')}
                  </h2>
                  <div className="hidden md:flex items-center gap-4 bg-white p-2 pr-6 rounded-2xl border border-slate-100 shadow-sm">
                    {/* Indicador de País */}
                    <div className="flex items-center gap-2 px-3 border-r border-slate-100">
                       <Globe className="w-4 h-4 text-slate-400" />
                       <span className="text-xs font-bold text-slate-500 uppercase tracking-wider">{userCountry}</span>
                    </div>
                    <div className="bg-amber-50 p-3 rounded-xl text-amber-500"><Sun className="w-5 h-5" /></div>
                    <p className="text-lg font-black text-slate-800">{currentTime.toLocaleTimeString('es-UY', { hour: '2-digit', minute: '2-digit' })}</p>
                  </div>
                </header>

                {/* --- VISTAS --- */}

                {activeTab === 'dashboard' && (
                  <div className="space-y-10 animate-in fade-in duration-500">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                      <div className="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm">
                        <h3 className="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-6 flex items-center gap-2"><CloudSun className="w-4 h-4 text-amber-500"/> Tendencia Estacional UY ({themeData.seasonName})</h3>
                        <div className="flex h-16 rounded-3xl overflow-hidden border border-slate-50 shadow-inner mb-4">
                          {themeData.seasonalPalette.map((c, i) => <div key={i} className="flex-1 hover:scale-110 transition-transform" style={{ backgroundColor: c }} />)}
                        </div>
                      </div>
                      <div className="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm">
                        <h3 className="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-6 flex items-center gap-2"><Palette className="w-4 h-4 text-[#E11D48]"/> Paleta de Campaña ({themeData.campaignName})</h3>
                        <div className="flex h-16 rounded-3xl overflow-hidden border border-slate-50 shadow-inner mb-4">
                          {themeData.campaignPalette.map((c, i) => <div key={i} className="flex-1 hover:scale-110 transition-transform" style={{ backgroundColor: c }} />)}
                        </div>
                      </div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      <div className="bg-slate-900 p-8 rounded-[2.5rem] text-white shadow-xl relative overflow-hidden">
                        <div className="absolute top-0 right-0 p-8 opacity-10"><BarChart3 className="w-24 h-24" /></div>
                        <h3 className="text-[11px] font-black text-indigo-400 uppercase tracking-widest mb-4">Balance Neto</h3>
                        <p className="text-4xl font-black italic tracking-tighter">${netBalance}</p>
                      </div>
                      <div className="bg-emerald-50 p-8 rounded-[2.5rem] border border-emerald-100 flex flex-col justify-between">
                        <h3 className="text-[11px] font-black text-emerald-600 uppercase tracking-widest mb-4">Ingresos Totales</h3>
                        <p className="text-4xl font-black text-emerald-800 tracking-tighter">${totalIncomes}</p>
                      </div>
                      <div className="bg-rose-50 p-8 rounded-[2.5rem] border border-rose-100 flex flex-col justify-between">
                        <h3 className="text-[11px] font-black text-rose-600 uppercase tracking-widest mb-4">Gastos Totales</h3>
                        <p className="text-4xl font-black text-rose-800 tracking-tighter">${totalExpenses}</p>
                      </div>
                    </div>

                    {/* WIDGETS DE ACCESO DIRECTO */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      {/* WhatsApp Widget */}
                      <a href="https://web.whatsapp.com/" target="_blank" rel="noreferrer" className="bg-[#25D366] p-8 rounded-[2.5rem] text-white shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all flex items-center gap-5 group cursor-pointer border border-[#20b858]">
                        <div className="p-4 bg-white/20 rounded-2xl group-hover:rotate-6 transition-transform"><MessageCircle className="w-8 h-8" /></div>
                        <div><p className="text-[10px] font-black uppercase tracking-widest opacity-80 mb-1">Abrir Chat</p><h3 className="text-2xl font-black italic tracking-tight">WhatsApp</h3></div>
                      </a>
                      
                      {/* Instagram Widget */}
                      <a href="https://www.instagram.com/" target="_blank" rel="noreferrer" className="bg-gradient-to-tr from-amber-400 via-rose-500 to-purple-600 p-8 rounded-[2.5rem] text-white shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all flex items-center gap-5 group cursor-pointer border border-transparent">
                        <div className="p-4 bg-white/20 rounded-2xl group-hover:rotate-6 transition-transform"><Instagram className="w-8 h-8" /></div>
                        <div><p className="text-[10px] font-black uppercase tracking-widest opacity-80 mb-1">Mi Feed</p><h3 className="text-2xl font-black italic tracking-tight">Instagram</h3></div>
                      </a>

                      {/* Gmail Widget */}
                      <a href="https://mail.google.com/" target="_blank" rel="noreferrer" className="bg-slate-900 p-8 rounded-[2.5rem] text-white shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all flex items-center gap-5 group cursor-pointer border border-slate-800">
                        <div className="p-4 bg-white/20 rounded-2xl group-hover:rotate-6 transition-transform"><Mail className="w-8 h-8" /></div>
                        <div><p className="text-[10px] font-black uppercase tracking-widest opacity-80 mb-1">Bandeja</p><h3 className="text-2xl font-black italic tracking-tight">Gmail</h3></div>
                      </a>
                    </div>
                  </div>
                )}

                {/* --- MODULO DE PRESUPUESTOS --- */}
                {activeTab === 'presupuestos' && (
                  <div className="space-y-8 animate-in slide-in-from-bottom-5">
                    {!isCreatingBudget ? (
                      // VISTA DE LISTA
                      <>
                        <div className="flex justify-end gap-3">
                          <button 
                            onClick={() => {
                              const dataToExport = presupuestos.map(p => ({
                                ID: p.id,
                                Cliente: p.client,
                                Fecha: p.date,
                                Estado: p.status,
                                Total: calculateBudgetTotal(p.items),
                                Items: p.items.map(i => `${i.qty}x ${i.desc} ($${i.price})`).join(' | '),
                                Notas: p.notes
                              }));
                              exportToCSV(dataToExport, 'Presupuestos_MCPro');
                            }} 
                            className="flex items-center gap-3 bg-white text-slate-600 border border-slate-200 px-6 py-4 rounded-2xl font-bold uppercase shadow-sm hover:bg-slate-50 transition-colors"
                          >
                            <Download className="w-5 h-5"/> Exportar
                          </button>
                          <button 
                            onClick={() => { resetBudgetForm(); setIsCreatingBudget(true); }}
                            className="flex items-center gap-3 bg-[#E11D48] text-white px-8 py-4 rounded-2xl font-black uppercase shadow-xl hover:scale-105 transition-transform"
                          >
                            <PlusCircle className="w-5 h-5"/> Crear Nuevo
                          </button>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                          {presupuestos.length === 0 ? (
                            <div className="col-span-full py-20 text-center opacity-50">
                              <FileText className="w-16 h-16 mx-auto mb-4 text-slate-300"/>
                              <p className="text-xl font-bold text-slate-400">No hay presupuestos creados aún.</p>
                            </div>
                          ) : (
                            presupuestos.map(budget => (
                              <div key={budget.id} className="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm relative group hover:border-rose-100 transition-all flex flex-col justify-between h-full">
                                <div>
                                  <div className="flex justify-between items-start mb-4">
                                     <span className={`px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest ${
                                       budget.status === 'Aprobado' ? 'bg-emerald-100 text-emerald-600' : 
                                       budget.status === 'Rechazado' ? 'bg-red-100 text-red-600' : 
                                       'bg-amber-100 text-amber-600'
                                     }`}>
                                       {budget.status}
                                     </span>
                                     <button onClick={() => deleteItem(budget.id, setPresupuestos, "Presupuesto")} className="text-slate-200 hover:text-red-500"><Trash2 className="w-5 h-5"/></button>
                                  </div>
                                  <h4 className="text-xl font-black text-slate-800 uppercase italic mb-1">{budget.client}</h4>
                                  <p className="text-xs font-bold text-slate-400 mb-6">{new Date(budget.date).toLocaleDateString()}</p>
                                  <div className="space-y-2 mb-6">
                                    {budget.items.slice(0, 3).map(item => (
                                      <div key={item.id} className="flex justify-between text-sm text-slate-600 border-b border-slate-50 pb-1">
                                        <span className="truncate w-3/4 font-medium">{item.qty} x {item.desc}</span>
                                        <span className="font-bold">${Number(item.qty) * Number(item.price)}</span>
                                      </div>
                                    ))}
                                    {budget.items.length > 3 && <p className="text-xs text-slate-400 italic">+ {budget.items.length - 3} ítems más...</p>}
                                  </div>
                                </div>
                                <div className="pt-4 border-t border-slate-100 flex justify-between items-end mt-auto">
                                  <div>
                                    <p className="text-[9px] font-black text-slate-400 uppercase tracking-widest">Total</p>
                                    <p className="text-2xl font-black text-slate-800 tracking-tight">${calculateBudgetTotal(budget.items)}</p>
                                  </div>
                                  <button onClick={() => editBudget(budget)} className="p-3 bg-slate-50 rounded-xl text-slate-600 hover:bg-slate-900 hover:text-white transition-colors"><Edit2 className="w-5 h-5"/></button>
                                </div>
                              </div>
                            ))
                          )}
                        </div>
                      </>
                    ) : (
                      // VISTA DE CREACION / EDICION
                      <div className="max-w-5xl mx-auto bg-white p-8 md:p-12 rounded-[3rem] shadow-sm border border-slate-100 animate-in zoom-in duration-300">
                         <div className="flex justify-between items-center mb-8 border-b border-slate-50 pb-6">
                            <h3 className="text-2xl font-black uppercase italic text-slate-800 flex items-center gap-3">
                              <FileCheck className="w-8 h-8 text-[#E11D48]"/> {currentBudget.id ? 'Editar Presupuesto' : 'Nuevo Presupuesto'}
                            </h3>
                            <div className="flex gap-3">
                              <button onClick={() => setIsCreatingBudget(false)} className="px-6 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-50 transition-colors">Cancelar</button>
                              <button onClick={saveBudget} className="px-8 py-3 bg-slate-900 text-white rounded-xl font-black uppercase shadow-lg hover:bg-black transition-colors flex items-center gap-2"><Save className="w-4 h-4"/> Guardar</button>
                            </div>
                         </div>

                         <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div className="space-y-2">
                               <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Cliente</label>
                               <input 
                                 value={currentBudget.client}
                                 onChange={(e) => handleBudgetChange('client', e.target.value)}
                                 placeholder="Nombre del Cliente"
                                 className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-lg"
                               />
                            </div>
                            <div className="space-y-2">
                               <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Fecha</label>
                               <input 
                                 type="date"
                                 value={currentBudget.date}
                                 onChange={(e) => handleBudgetChange('date', e.target.value)}
                                 className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-lg"
                               />
                            </div>
                            <div className="space-y-2">
                               <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Estado</label>
                               <select 
                                 value={currentBudget.status}
                                 onChange={(e) => handleBudgetChange('status', e.target.value)}
                                 className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-lg"
                               >
                                 <option value="Pendiente">Pendiente</option>
                                 <option value="Aprobado">Aprobado</option>
                                 <option value="Rechazado">Rechazado</option>
                               </select>
                            </div>
                         </div>

                         <div className="bg-slate-50 rounded-[2rem] p-6 mb-8">
                            <div className="flex justify-between items-center mb-4 px-2">
                               <h4 className="text-[11px] font-black text-slate-400 uppercase tracking-widest">Detalle de Ítems</h4>
                            </div>
                            <div className="space-y-3">
                              {currentBudget.items.map((item, index) => (
                                <div key={item.id} className="flex flex-wrap md:flex-nowrap gap-3 items-center bg-white p-3 rounded-2xl shadow-sm">
                                   <div className="w-16">
                                     <input 
                                       type="number"
                                       min="1"
                                       value={item.qty}
                                       onChange={(e) => updateBudgetItem(item.id, 'qty', e.target.value)}
                                       placeholder="Cant."
                                       className="w-full p-3 bg-slate-50 rounded-xl outline-none font-black text-center"
                                     />
                                   </div>
                                   <div className="flex-1">
                                     <input 
                                       value={item.desc}
                                       onChange={(e) => updateBudgetItem(item.id, 'desc', e.target.value)}
                                       placeholder="Descripción del producto o servicio..."
                                       className="w-full p-3 bg-slate-50 rounded-xl outline-none font-medium"
                                     />
                                   </div>
                                   <div className="w-24">
                                     <input 
                                       type="number"
                                       value={item.price}
                                       onChange={(e) => updateBudgetItem(item.id, 'price', e.target.value)}
                                       placeholder="Precio"
                                       className="w-full p-3 bg-slate-50 rounded-xl outline-none font-bold text-right"
                                     />
                                   </div>
                                   <div className="w-24 text-right px-3 font-black text-lg text-slate-700">
                                     ${(item.qty * item.price).toFixed(0)}
                                   </div>
                                   <button onClick={() => removeBudgetItem(item.id)} className="p-3 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-xl transition-colors"><Trash2 className="w-5 h-5"/></button>
                                </div>
                              ))}
                            </div>
                            <button onClick={addBudgetItem} className="mt-4 flex items-center gap-2 text-[11px] font-black uppercase tracking-widest text-[#E11D48] hover:bg-rose-50 px-4 py-2 rounded-xl transition-colors">
                              <PlusCircle className="w-4 h-4"/> Agregar Ítem
                            </button>
                         </div>

                         <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-8 border-t border-slate-100 pt-8">
                            <div className="w-full md:w-1/2">
                               <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2 mb-2 block">Notas Adicionales</label>
                               <textarea 
                                 value={currentBudget.notes}
                                 onChange={(e) => handleBudgetChange('notes', e.target.value)}
                                 placeholder="Condiciones de pago, plazos de entrega, etc."
                                 className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-medium h-24 resize-none"
                               />
                            </div>
                            <div className="bg-slate-900 text-white p-8 rounded-[2.5rem] min-w-[300px] text-right shadow-xl">
                               <p className="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-1">Total Presupuestado</p>
                               <p className="text-5xl font-black tracking-tighter italic">${calculateBudgetTotal(currentBudget.items)}</p>
                            </div>
                         </div>
                      </div>
                    )}
                  </div>
                )}

                {activeTab === 'strategies' && (
                  <div className="space-y-8 animate-in fade-in duration-500">
                     {/* Header Banner */}
                     <div className="bg-slate-900 text-white p-8 rounded-[3rem] shadow-2xl relative overflow-hidden flex flex-col md:flex-row items-center justify-between gap-6">
                        <div className="relative z-10">
                           <div className="flex items-center gap-3 mb-2">
                              <span className="px-3 py-1 bg-[#E11D48] rounded-full text-[10px] font-black uppercase tracking-widest">Temporada {themeData.seasonName}</span>
                              <span className="px-3 py-1 bg-white/20 rounded-full text-[10px] font-black uppercase tracking-widest text-white">Uruguay 2026</span>
                           </div>
                           <h3 className="text-4xl md:text-5xl font-black italic tracking-tighter mb-2">Campaña {themeData.strategies?.title}</h3>
                           <p className="text-slate-400 font-medium max-w-md">Estrategias diseñadas para potenciar tu taller creativo este mes.</p>
                        </div>
                        <div className="relative z-10 p-4 bg-white/10 backdrop-blur-md rounded-3xl border border-white/10">
                            <Sparkles className="w-12 h-12 text-amber-400" />
                        </div>
                        {/* Decorative background circles */}
                        <div className="absolute top-0 right-0 w-64 h-64 bg-[#E11D48] rounded-full blur-[100px] opacity-20 -translate-y-1/2 translate-x-1/2"></div>
                     </div>

                     <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        {/* Ideas Module */}
                        <div className="lg:col-span-2 bg-white p-8 rounded-[3rem] border border-slate-100 shadow-sm">
                           <div className="flex items-center gap-3 mb-6">
                              <div className="p-3 bg-indigo-50 rounded-2xl text-indigo-600"><Gift className="w-6 h-6" /></div>
                              <h4 className="text-lg font-black text-slate-800 uppercase italic">Productos Sugeridos</h4>
                           </div>
                           <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              {themeData.strategies?.ideas.map((idea, i) => (
                                <div key={i} className="group p-5 rounded-[2.5rem] bg-slate-50 border border-transparent hover:border-indigo-100 hover:bg-indigo-50/30 transition-all cursor-default">
                                   <div className="flex items-start justify-between mb-3">
                                      <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center text-slate-300 shadow-sm group-hover:text-indigo-500 transition-colors">
                                        <Star className="w-5 h-5 fill-current" />
                                      </div>
                                      <span className="text-[10px] font-black text-slate-300 uppercase tracking-widest">#{i+1}</span>
                                   </div>
                                   <p className="font-bold text-slate-700 leading-tight">{idea}</p>
                                </div>
                              ))}
                           </div>
                        </div>

                        {/* Trends & Palette Module */}
                        <div className="bg-white p-8 rounded-[3rem] border border-slate-100 shadow-sm flex flex-col">
                           <div className="flex items-center gap-3 mb-6">
                              <div className="p-3 bg-amber-50 rounded-2xl text-amber-500"><Palette className="w-6 h-6" /></div>
                              <h4 className="text-lg font-black text-slate-800 uppercase italic">Estética Visual</h4>
                           </div>
                           
                           <div className="flex-1 bg-slate-50 rounded-[2.5rem] p-6 mb-6 relative overflow-hidden">
                              <div className="absolute top-0 right-0 p-4 opacity-5"><Sun className="w-24 h-24" /></div>
                              <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">Tendencia del Mes</p>
                              <p className="text-xl font-black text-slate-800 italic leading-snug">"{themeData.strategies?.trend}"</p>
                           </div>

                           <div>
                              <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3 ml-2">Paleta Sugerida</p>
                              <div className="flex h-12 rounded-2xl overflow-hidden shadow-sm">
                                {themeData.campaignPalette.map((c, i) => (
                                  <div key={i} className="flex-1 group relative" style={{ backgroundColor: c }}>
                                     <div className="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors" />
                                  </div>
                                ))}
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                )}

                {activeTab === 'finances' && (
                  <div className="space-y-10 animate-in slide-in-from-bottom-5">
                    <div className="flex justify-end gap-3">
                       <button 
                          onClick={() => {
                            const incomes = clients.map(c => ({ Tipo: 'Venta', Descripcion: c.name, Monto: c.amount, Fecha: c.date })).concat(extraIncomes.map(i => ({ Tipo: 'Ingreso Extra', Descripcion: i.name, Monto: i.amount, Fecha: i.date })));
                            const expensesData = expenses.map(e => ({ Tipo: 'Gasto', Descripcion: e.name, Monto: -e.amount, Fecha: e.date }));
                            exportToCSV([...incomes, ...expensesData], 'Reporte_Financiero_MCPro');
                          }} 
                          className="flex items-center gap-2 bg-slate-800 text-white px-5 py-3 rounded-xl font-bold uppercase text-xs tracking-widest shadow-lg hover:bg-black transition-colors"
                        >
                          <Download className="w-4 h-4"/> Descargar Reporte
                        </button>
                    </div>
                    <div className="bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100 flex flex-wrap gap-10 justify-around items-center">
                      <div className="text-center"><p className="text-[10px] font-black text-emerald-500 uppercase tracking-widest mb-2">Total Ingresos</p><p className="text-3xl font-black text-slate-800">${totalIncomes}</p></div>
                      <div className="text-center"><p className="text-[10px] font-black text-rose-500 uppercase tracking-widest mb-2">Total Gastos</p><p className="text-3xl font-black text-slate-800">${totalExpenses}</p></div>
                      <div className="text-center"><p className="text-[10px] font-black text-[#E11D48] uppercase tracking-widest mb-2">Balance Neto</p><p className={`text-4xl font-black ${netBalance >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>${netBalance}</p></div>
                    </div>
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-10">
                      <div className="bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100">
                        <h3 className="text-xl font-black mb-8 uppercase italic flex items-center gap-3 text-emerald-600"><ArrowUpCircle className="w-7 h-7"/> Nuevo Ingreso</h3>
                        <form onSubmit={(e) => saveEntity(e, setExtraIncomes, editingIncome, setEditingIncome, "Ingreso")} className="space-y-4">
                          <input name="name" required placeholder="Concepto" className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold" />
                          <div className="flex gap-4"><input name="amount" type="number" required placeholder="Monto $" className="flex-1 p-4 bg-slate-50 rounded-2xl outline-none font-bold" /><button type="submit" className="px-10 bg-emerald-500 text-white rounded-2xl font-black uppercase shadow-lg">Añadir</button></div>
                        </form>
                      </div>
                      <div className="bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100">
                        <h3 className="text-xl font-black mb-8 uppercase italic flex items-center gap-3 text-rose-600"><ArrowDownCircle className="w-7 h-7"/> Registrar Gasto</h3>
                        <form onSubmit={(e) => saveEntity(e, setExpenses, editingExpense, setEditingExpense, "Gasto")} className="space-y-4">
                          <input name="name" required placeholder="Concepto" className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold" />
                          <div className="flex gap-4"><input name="amount" type="number" required placeholder="Monto $" className="flex-1 p-4 bg-slate-50 rounded-2xl outline-none font-bold" /><button type="submit" className="px-10 bg-rose-500 text-white rounded-2xl font-black uppercase shadow-lg">Añadir</button></div>
                        </form>
                      </div>
                    </div>
                  </div>
                )}

                {/* --- INVENTARIO --- */}
                {activeTab === 'inventory' && (
                  <div className="space-y-10 animate-in slide-in-from-bottom-5">
                    <div className="bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100">
                       <div className="flex justify-between items-start mb-8">
                         <h3 className="text-xl font-black uppercase italic flex items-center gap-3 text-[#E11D48]"><Package className="w-7 h-7"/> Gestión de Insumos</h3>
                         <button onClick={() => exportToCSV(inventory, 'Inventario_MCPro')} className="text-slate-400 hover:text-[#E11D48] transition-colors"><Download className="w-6 h-6"/></button>
                       </div>
                       <form onSubmit={(e) => saveEntity(e, setInventory, editingInv, setEditingInv, "Insumo")} className="grid grid-cols-1 md:grid-cols-4 gap-6">
                          <input name="name" required placeholder="Papel, Vinilo, Foil..." className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold" />
                          <input name="qty" type="number" required placeholder="Stock Actual" className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold" />
                          <input name="price" type="number" required placeholder="Precio de Costo" className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold" />
                          <button type="submit" className="bg-[#E11D48] text-white rounded-2xl font-black uppercase py-4 shadow-xl">Añadir Stock</button>
                       </form>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                      {inventory.map(item => (
                        <div key={item.id} className="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm flex flex-col justify-between hover:border-rose-100 transition-all">
                          <div className="flex justify-between items-start mb-4">
                            <div className="p-3 bg-rose-50 rounded-xl text-[#E11D48]"><Box className="w-6 h-6" /></div>
                            <button onClick={() => deleteItem(item.id, setInventory, "Insumo")} className="text-slate-200 hover:text-rose-500"><Trash2 className="w-5 h-5"/></button>
                          </div>
                          <h4 className="font-black text-slate-800 uppercase text-lg leading-tight mb-2">{item.name}</h4>
                          <div className="flex justify-between items-end border-t border-slate-50 pt-4 mt-4">
                            <div><p className="text-[9px] font-black text-slate-400 uppercase tracking-widest">En Stock</p><p className="text-3xl font-black text-slate-800 italic">{item.qty}</p></div>
                            <div className="text-right"><p className="text-[9px] font-black text-slate-400 uppercase tracking-widest">Costo Unit.</p><p className="text-xl font-black text-emerald-500 italic">${item.price}</p></div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* --- TALLER / CHECKLIST --- */}
                {activeTab === 'checklist' && (
                  <div className="space-y-10 animate-in slide-in-from-bottom-5">
                    <div className="bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100">
                       <div className="flex justify-between items-start mb-8">
                         <h3 className="text-xl font-black uppercase italic flex items-center gap-3 text-slate-800"><ClipboardList className="w-7 h-7 text-[#E11D48]"/> Nuevo Proyecto en Taller</h3>
                         <button onClick={() => exportToCSV(tasks, 'Tareas_MCPro')} className="text-slate-400 hover:text-[#E11D48] transition-colors"><Download className="w-6 h-6"/></button>
                       </div>
                       <form onSubmit={(e) => saveEntity(e, setTasks, editingTask, setEditingTask, "Tarea")} className="space-y-6">
                          <input name="title" required placeholder="Nombre del Trabajo (Ej: Box San Valentín - Cliente X)" className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-lg focus:ring-2 ring-rose-50 transition-all" />
                          <textarea name="details" placeholder="Especificaciones técnicas, gramaje, laminado, terminaciones..." className="w-full p-6 bg-slate-50 rounded-2xl outline-none font-medium h-32 focus:ring-2 ring-rose-50 transition-all" />
                          <button type="submit" className="w-full bg-slate-900 text-white rounded-2xl font-black uppercase py-5 shadow-xl hover:bg-black transition-all">Crear Ficha Técnica</button>
                       </form>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      {tasks.map(t => (
                        <div key={t.id} className={`bg-white p-8 rounded-[2.5rem] border flex items-center justify-between transition-all ${t.completed ? 'opacity-40 grayscale' : 'shadow-sm border-slate-100 hover:border-rose-100'}`}>
                          <div className="flex items-center gap-6">
                            <button onClick={() => setTasks(tasks.map(x => x.id === t.id ? {...x, completed: !x.completed} : x))} className={`w-14 h-14 rounded-2xl flex items-center justify-center transition-all ${t.completed ? 'bg-emerald-500 text-white shadow-emerald-100 shadow-lg' : 'bg-slate-50 text-slate-200 border-2 border-slate-100'}`}><CheckCircle2 className="w-8 h-8"/></button>
                            <div><h4 className="font-black text-slate-800 uppercase tracking-tight text-lg">{t.title}</h4><p className="text-xs text-slate-400 font-medium normal-case mt-1">{t.details}</p></div>
                          </div>
                          <button onClick={() => deleteItem(t.id, setTasks, "Tarea")} className="text-slate-200 hover:text-rose-500 transition-colors"><Trash2 className="w-5 h-5"/></button>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* --- PLANNER: CALENDARIO --- */}
                {activeTab === 'planner' && (
                  <div className="grid grid-cols-1 xl:grid-cols-3 gap-6 animate-in fade-in duration-500">
                    <div className="xl:col-span-2 bg-white p-6 rounded-[2.5rem] shadow-2xl border border-slate-100">
                       <div className="flex justify-between items-center mb-6">
                          <div className="flex items-center gap-4">
                            <div className="p-2.5 rounded-xl text-white shadow-lg" style={{ backgroundColor: themeData.primaryColor }}><CalendarIcon className="w-5 h-5" /></div>
                            <div><h3 className="text-xl font-black text-slate-800 uppercase italic tracking-tighter">{viewDate.toLocaleDateString('es-UY', { month: 'long', year: 'numeric' })}</h3><p className="text-[8px] font-black text-slate-400 uppercase tracking-widest mt-1">{countryNames[userCountry] || 'Global'} & Community Manager 2026</p></div>
                          </div>
                          <div className="flex gap-2">
                            <button onClick={() => setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() - 1, 1))} className="p-2.5 bg-slate-50 rounded-xl border border-slate-100"><ChevronLeft className="w-4 h-4" /></button>
                            <button onClick={() => setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 1))} className="p-2.5 bg-slate-50 rounded-xl border border-slate-100"><ChevronRight className="w-4 h-4" /></button>
                          </div>
                       </div>
                       <div className="grid grid-cols-7 gap-1.5">
                         {['LUN', 'MAR', 'MIÉ', 'JUE', 'VIE', 'SÁB', 'DOM'].map(d => <div key={d} className="text-center text-[13px] font-black text-slate-900 uppercase tracking-widest pb-4 border-b border-slate-50">{d}</div>)}
                         {calendarDays.map((day, i) => {
                           const key = day ? getDayKey(day) : null;
                           const isToday = day && day === new Date().getDate() && viewDate.getMonth() === new Date().getMonth();
                           const isSelected = day === selectedDay;
                           // Filtrado Inteligente: SIEMPRE muestra UY, más globales (INT, CM) y el país detectado
                           const events = day ? perpetualEvents.filter(e => e.d === day && e.m === viewDate.getMonth() && (e.type === 'INT' || e.type === 'CM' || e.type === 'UY' || e.type === userCountry)) : [];
                           const hasNote = key && personalEvents[key];
                           return (
                             <div key={i} onClick={() => day && setSelectedDay(day)} className={`min-h-[80px] p-2 rounded-xl border transition-all cursor-pointer flex flex-col justify-between ${!day ? 'bg-transparent border-transparent' : isSelected ? 'bg-slate-900 text-white border-transparent shadow-xl z-10' : isToday ? 'bg-red-50 text-[#E11D48] border-[#E11D48] font-bold' : 'bg-white border-slate-100 hover:border-red-200'}`}>
                                {day && (<><span className="text-lg font-black">{day}</span><div className="flex flex-wrap gap-1">{events.map((e, idx) => (<div key={idx} className={`w-full h-1 rounded-full ${e.type === 'CM' ? 'bg-[#E11D48]' : e.type === 'UY' ? 'bg-blue-400' : 'bg-amber-400'}`} />))}{hasNote && <div className="w-full h-1 rounded-full bg-indigo-500" />}</div></>)}
                             </div>
                           );
                         })}
                       </div>
                    </div>
                    <div className="bg-white p-6 rounded-[2rem] shadow-xl border border-slate-100 flex flex-col gap-4">
                       <div className="text-center bg-slate-50 p-4 rounded-2xl border border-slate-100">
                          <p className="text-[8px] font-black text-[#E11D48] uppercase tracking-[0.4em] mb-1">Campaña / Festejo</p>
                          <h4 className="text-2xl font-black text-slate-800 uppercase italic tracking-tighter leading-none">{selectedDay} {viewDate.toLocaleDateString('es-UY', { month: 'short' })}</h4>
                       </div>
                       <div className="flex-1 space-y-4 overflow-y-auto pr-1">
                          {perpetualEvents.filter(e => e.d === selectedDay && e.m === viewDate.getMonth() && (e.type === 'INT' || e.type === 'CM' || e.type === 'UY' || e.type === userCountry)).map((ev, i) => (
                            <div key={i} className={`p-4 rounded-xl border relative overflow-hidden ${ev.type === 'CM' ? 'bg-rose-50/50 border-rose-100' : ev.type === 'UY' ? 'bg-blue-50/50 border-blue-100' : 'bg-amber-50/50 border-amber-100'}`}>
                               <p className="text-[12px] font-black uppercase italic text-slate-800 mb-1 leading-tight">{ev.t}</p>
                               <p className="text-[10px] text-slate-500 italic leading-tight">{ev.info}</p>
                               {/* Badge de tipo */}
                               <span className="absolute top-2 right-2 text-[8px] font-black opacity-30">{ev.type}</span>
                            </div>
                          ))}
                          <div className="pt-4 border-t border-slate-100">
                            <h5 className="text-[9px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2 mb-3"><StickyNote className="w-3.5 h-3.5 text-[#E11D48]"/> Mis Notas</h5>
                            {personalEvents[getDayKey(selectedDay)] ? (
                              <div className="flex items-center justify-between p-4 bg-indigo-50/50 rounded-xl border border-indigo-100 group">
                                <span className="text-[11px] font-bold text-indigo-700 leading-tight">{personalEvents[getDayKey(selectedDay)]}</span>
                                <button onClick={() => {const n = {...personalEvents}; delete n[getDayKey(selectedDay)]; setPersonalEvents(n); notify("Borrada");}} className="text-red-400 hover:scale-110 transition-transform"><Trash2 className="w-4 h-4"/></button>
                              </div>
                            ) : (
                              <form onSubmit={(e) => {e.preventDefault(); if(!e.target.note.value.trim()) return; setPersonalEvents({...personalEvents, [getDayKey(selectedDay)]: e.target.note.value}); e.target.reset(); notify("Guardado");}} className="flex gap-1.5">
                                <input name="note" placeholder="Escribir..." className="flex-1 p-2.5 bg-slate-50 rounded-lg text-[11px] font-bold outline-none" /><button type="submit" className="p-2.5 bg-slate-900 text-white rounded-lg"><Save className="w-4 h-4"/></button>
                              </form>
                            )}
                          </div>
                       </div>
                    </div>
                  </div>
                )}

                {activeTab === 'shipping' && (
                  <div className="space-y-8 animate-in slide-in-from-bottom-5">
                    <div className="bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100">
                       <div className="flex justify-between items-start mb-8">
                         <h3 className="text-xl font-black uppercase italic flex items-center gap-3 text-indigo-500"><Truck className="w-7 h-7"/> Gestión de Despachos UY</h3>
                         <button onClick={() => exportToCSV(shipping, 'Envios_MCPro')} className="text-slate-400 hover:text-indigo-500 transition-colors"><Download className="w-6 h-6"/></button>
                       </div>
                       <form onSubmit={(e) => saveEntity(e, setShipping, editingShipment, setEditingShipment, "Envío")} className="grid grid-cols-1 md:grid-cols-4 gap-6">
                          <input name="client" required placeholder="Cliente" className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold" />
                          <select name="agency" required className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold"><option value="DAC">DAC</option><option value="UES">UES</option><option value="De Punta">De Punta</option><option value="Correo Uruguayo">Correo Uruguayo</option></select>
                          <input name="tracking" placeholder="Tracking" className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold" />
                          <button type="submit" className="bg-indigo-600 text-white rounded-2xl font-black uppercase py-4 shadow-xl">Despachar</button>
                       </form>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      {shipping.map(s => (
                        <div key={s.id} className="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm relative overflow-hidden group">
                          <div className={`absolute top-0 right-0 w-2 h-full ${s.agency === 'DAC' ? 'bg-red-600' : s.agency === 'UES' ? 'bg-blue-600' : s.agency === 'De Punta' ? 'bg-amber-500' : 'bg-emerald-600'}`}></div>
                          <h4 className="font-black text-slate-800 uppercase text-lg mb-1">{s.client}</h4>
                          <span className="px-3 py-1 rounded-full text-[9px] font-black uppercase bg-slate-900 text-white">{s.agency}</span>
                          <div className="mt-4 p-3 bg-slate-50 rounded-xl flex items-center gap-3"><Zap className="w-4 h-4 text-indigo-500" /><p className="text-[12px] font-bold text-slate-700">{s.tracking || 'S/N'}</p></div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {activeTab === 'clients' && (
                  <div className="space-y-8 animate-in slide-in-from-bottom-5">
                    <div className="bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100">
                       <div className="flex justify-between items-start mb-8">
                         <h3 className="text-xl font-black uppercase italic flex items-center gap-3"><Plus className="w-6 h-6 text-[#E11D48]"/> Registrar Venta</h3>
                         <button onClick={() => exportToCSV(clients, 'Ventas_Clientes_MCPro')} className="text-slate-400 hover:text-[#E11D48] transition-colors"><Download className="w-6 h-6"/></button>
                       </div>
                       <form onSubmit={(e) => saveEntity(e, setClients, editingClient, setEditingClient, "Venta")} className="grid grid-cols-1 md:grid-cols-3 gap-6">
                          <input name="name" required placeholder="Cliente" className="p-4 bg-slate-50 rounded-2xl outline-none font-bold" />
                          <input name="amount" type="number" required placeholder="Monto $" className="p-4 bg-slate-50 rounded-2xl outline-none font-bold" />
                          <button type="submit" className="bg-[#E11D48] text-white rounded-2xl font-black uppercase py-4 shadow-lg">Guardar</button>
                       </form>
                    </div>
                    <div className="bg-white rounded-[3rem] border border-slate-100 overflow-hidden shadow-sm">
                      <table className="w-full text-left">
                        <thead className="bg-slate-50 text-slate-400 font-bold text-[10px] uppercase tracking-widest border-b border-slate-100"><tr><th className="px-10 py-6">Cliente</th><th className="px-10 py-6">Monto</th><th className="px-10 py-6 text-center">Acciones</th></tr></thead>
                        <tbody className="divide-y divide-slate-50">{clients.map(c => (<tr key={c.id} className="hover:bg-rose-50/20 transition-all group"><td className="px-10 py-6 font-black uppercase text-slate-700">{c.name}</td><td className="px-10 py-6 font-black text-[#E11D48] italic tracking-tighter text-lg">${c.amount}</td><td className="px-10 py-6 text-center"><button onClick={() => deleteItem(c.id, setClients, "Venta")} className="text-slate-200 hover:text-red-500 transition-colors"><Trash2 className="w-5 h-5"/></button></td></tr>))}</tbody>
                      </table>
                    </div>
                  </div>
                )}

                {activeTab === 'calculator' && (
                  <div className="max-w-7xl mx-auto space-y-10 animate-in zoom-in duration-500">
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                      <div className="lg:col-span-2 bg-white p-10 rounded-[3.5rem] shadow-sm border border-slate-100 space-y-8">
                        <div className="flex items-center gap-4 mb-4"><div className="p-3 bg-[#E11D48] rounded-xl text-white shadow-lg"><Calculator className="w-6 h-6" /></div><h3 className="text-xl font-black uppercase italic text-slate-800">Escandallo Pro de Papelería</h3></div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <div className="space-y-4"><h4 className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Insumos y Materiales</h4>
                            <div className="space-y-3">
                              <div><label className="text-[10px] font-bold text-slate-400 block mb-1 uppercase ml-1">Costo Materiales ($)</label><input type="number" className="w-full p-4 bg-slate-50 rounded-2xl font-black text-xl outline-none" value={calc.materialCost || ''} onChange={e => setCalc({...calc, materialCost: Number(e.target.value)})} /></div>
                              <div><label className="text-[10px] font-bold text-slate-400 block mb-1 uppercase ml-1">% Desperdicio</label><input type="number" className="w-full p-4 bg-slate-50 rounded-2xl font-black text-xl outline-none" value={calc.wastePercent || ''} onChange={e => setCalc({...calc, wastePercent: Number(e.target.value)})} /></div>
                            </div>
                          </div>
                          <div className="space-y-4"><h4 className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Tiempos y Fijos</h4>
                            <div className="space-y-3">
                              <div className="flex gap-2"><div className="flex-1"><label className="text-[10px] font-bold text-slate-400 block mb-1 uppercase ml-1">Hs Diseño</label><input type="number" className="w-full p-4 bg-slate-50 rounded-2xl font-black text-xl outline-none" value={calc.designHours || ''} onChange={e => setCalc({...calc, designHours: Number(e.target.value)})} /></div><div className="flex-1"><label className="text-[10px] font-bold text-slate-400 block mb-1 uppercase ml-1">Hs Armado</label><input type="number" className="w-full p-4 bg-slate-50 rounded-2xl font-black text-xl outline-none" value={calc.productionHours || ''} onChange={e => setCalc({...calc, productionHours: Number(e.target.value)})} /></div></div>
                              <div><label className="text-[10px] font-bold text-slate-400 block mb-1 uppercase ml-1">Precio Hora ($)</label><input type="number" className="w-full p-4 bg-slate-50 rounded-2xl font-black text-xl outline-none" value={calc.hourlyRate || ''} onChange={e => setCalc({...calc, hourlyRate: Number(e.target.value)})} /></div>
                            </div>
                          </div>
                        </div>
                        <div className="pt-4"><label className="text-[11px] font-black text-slate-400 block mb-3 uppercase tracking-widest ml-2">Margen Neto (%)</label><div className="flex items-center gap-6 p-2"><input type="range" min="0" max="300" step="5" className="flex-1 h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-[#E11D48]" value={calc.margin} onChange={e => setCalc({...calc, margin: Number(e.target.value)})} /><span className="w-20 text-center py-2 bg-slate-900 text-white rounded-xl font-black text-lg">{calc.margin}%</span></div></div>
                      </div>
                      <div className="bg-[#E11D48] p-10 rounded-[4rem] shadow-2xl flex flex-col justify-between border-[12px] border-white relative overflow-hidden text-white text-center">
                         <div className="relative z-10"><div className="bg-white/10 p-5 rounded-full inline-block mb-4"><DollarSign className="w-10 h-10" /></div><p className="text-[11px] font-black text-white/60 uppercase tracking-[0.5em] mb-2">Presupuesto Final</p><h4 className="text-8xl font-black italic tracking-tighter leading-none mb-4">${(( (calc.materialCost * (1 + (calc.wastePercent / 100))) + ((calc.designHours + calc.productionHours) * calc.hourlyRate) ) * (1 + (calc.margin / 100))).toFixed(0)}</h4></div>
                      </div>
                    </div>
                  </div>
                )}

              </main>

              {/* MODAL SOPORTE */}
              {showContactModal && (
                <div className="fixed inset-0 bg-slate-900/90 backdrop-blur-xl z-[200] flex items-center justify-center p-6 animate-in zoom-in duration-300">
                   <div className="bg-white max-w-lg w-full rounded-[4rem] p-12 text-center shadow-2xl relative overflow-hidden">
                      <div className="absolute top-0 left-0 w-full h-2 bg-[#E11D48]"></div>
                      <div className="w-24 h-24 bg-rose-50 text-[#E11D48] rounded-[2rem] flex items-center justify-center mx-auto mb-8 shadow-inner"><UserCheck className="w-12 h-12" /></div>
                      <h3 className="text-3xl font-black text-slate-800 uppercase italic mb-4 tracking-tighter">Soporte MC Pro</h3>
                      <p className="text-slate-500 mb-10 text-lg italic font-medium">¿Necesitas ayuda con la App o buscas insumos premium para tu estudio en Uruguay?</p>
                      <div className="space-y-4">
                        <a href="https://wa.me/59892617525" target="_blank" rel="noreferrer" className="flex items-center justify-center gap-3 w-full py-5 bg-[#25D366] text-white rounded-3xl font-black uppercase text-[12px] tracking-widest shadow-xl shadow-emerald-100 hover:scale-[1.02] transition-all"><MessageCircle className="w-5 h-5" /> WhatsApp Directo</a>
                        <a href="https://www.instagram.com/modocreativo.uy/" target="_blank" rel="noreferrer" className="flex items-center justify-center gap-3 w-full py-5 bg-gradient-to-tr from-amber-400 via-rose-500 to-purple-600 text-white rounded-3xl font-black uppercase text-[12px] tracking-widest shadow-xl shadow-rose-100 hover:scale-[1.02] transition-all"><Instagram className="w-5 h-5" /> @modocreativo.uy</a>
                        <button onClick={() => setShowContactModal(false)} className="block w-full py-4 text-slate-300 font-bold uppercase text-[10px] tracking-widest hover:text-[#E11D48] transition-colors">Cerrar</button>
                      </div>
                   </div>
                </div>
              )}
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>