<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MC Pro Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: '#E11D48',
                        dark: '#0f172a'
                    }
                }
            }
        }
    </script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- FIREBASE SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'mc-pro-default';
        const initialToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        if (firebaseConfig) {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            window.firebaseModules = { auth, db, appId, doc, setDoc, onSnapshot, collection, signInWithCustomToken, signInAnonymously };
            
            const initAuth = async (retries = 0) => {
                try {
                    if (initialToken) await signInWithCustomToken(auth, initialToken);
                    else await signInAnonymously(auth);
                } catch (error) {
                    if (retries < 5) {
                        const delay = Math.pow(2, retries) * 1000;
                        setTimeout(() => initAuth(retries + 1), delay);
                    } else {
                        console.error("Error Auth Final:", error);
                    }
                }
            };
            initAuth();
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; font-size: 14px; color: #334155; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.4s ease-out forwards; }
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .dots-bg {
            background-color: #ffffff;
            background-image: radial-gradient(#E11D48 1.5px, transparent 1.5px);
            background-size: 25px 25px;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- 1. COMPONENTES BASE DE ICONOS ---
        const Icon = ({ path, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} dangerouslySetInnerHTML={{__html: path}} />
        );

        const Icons = {
            Star: (p) => <Icon {...p} path='<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" fill="currentColor" />' />,
            Mail: (p) => <Icon {...p} path='<rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>' />,
            Lock: (p) => <Icon {...p} path='<rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>' />,
            Key: (p) => <Icon {...p} path='<circle cx="7.5" cy="15.5" r="5.5"/><path d="m21 2-9.6 9.6"/><path d="m15.5 7.5 3 3L22 7l-3-3"/>' />,
            Menu: (p) => <Icon {...p} path='<line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/>' />,
            Layout: (p) => <Icon {...p} path='<rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/>' />,
            Lightbulb: (p) => <Icon {...p} path='<path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/>' />,
            Wallet: (p) => <Icon {...p} path='<path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/>' />,
            DollarSign: (p) => <Icon {...p} path='<line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>' />,
            FileText: (p) => <Icon {...p} path='<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/>' />,
            Truck: (p) => <Icon {...p} path='<path d="M10 17h4V5H2v12h3"/><path d="M20 17h2v-3.34a4 4 0 0 0-1.17-2.83L19 9h-5"/><path d="M14 17h1"/><circle cx="7.5" cy="17.5" r="2.5"/><circle cx="17.5" cy="17.5" r="2.5"/>' />,
            Calendar: (p) => <Icon {...p} path='<rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/>' />,
            Package: (p) => <Icon {...p} path='<path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/>' />,
            ClipboardList: (p) => <Icon {...p} path='<rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/>' />,
            Calculator: (p) => <Icon {...p} path='<rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/>' />,
            ShieldCheck: (p) => <Icon {...p} path='<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/>' />,
            MessageCircle: (p) => <Icon {...p} path='<path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"/>' />,
            LogOut: (p) => <Icon {...p} path='<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/>' />,
            Settings: (p) => <Icon {...p} path='<circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1-2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>' />,
            Image: (p) => <Icon {...p} path='<rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>' />,
            CreditCard: (p) => <Icon {...p} path='<rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/>' />,
            Trash2: (p) => <Icon {...p} path='<path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/>' />,
            Edit2: (p) => <Icon {...p} path='<path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>' />,
            ChevronLeft: (p) => <Icon {...p} path='<path d="m15 18-6-6 6-6"/>' />,
            ChevronRight: (p) => <Icon {...p} path='<path d="m9 18 6-6-6-6"/>' />,
            Save: (p) => <Icon {...p} path='<path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>' />,
            Download: (p) => <Icon {...p} path='<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/>' />,
            X: (p) => <Icon {...p} path='<line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>' />,
            CheckCircle2: (p) => <Icon {...p} path='<circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/>' />,
            Globe: (p) => <Icon {...p} path='<circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>' />,
            Sun: (p) => <Icon {...p} path='<circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/>' />,
            CloudSun: (p) => <Icon {...p} path='<path d="M12 2v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="M20 12h2"/><path d="m19.07 4.93-1.41 1.41"/><path d="M15.947 12.65a4 4 0 0 0-5.925-4.128"/><path d="M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z"/>' />,
            Palette: (p) => <Icon {...p} path='<circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/>' />,
            PlusCircle: (p) => <Icon {...p} path='<circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/>' />,
            Plus: (p) => <Icon {...p} path='<path d="M5 12h14"/><path d="M12 5v14"/>' />,
            Instagram: (p) => <Icon {...p} path='<rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/>' />,
            Zap: (p) => <Icon {...p} path='<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>' />,
            BarChart3: (p) => <Icon {...p} path='<path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/>' />,
            ArrowUpCircle: (p) => <Icon {...p} path='<circle cx="12" cy="12" r="10"/><path d="m16 12-4-4-4 4"/><path d="M12 16V8"/>' />,
            ArrowDownCircle: (p) => <Icon {...p} path='<circle cx="12" cy="12" r="10"/><path d="m16 12-4 4-4-4"/><path d="M12 8v8"/>' />,
            Box: (p) => <Icon {...p} path='<path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" x2="12" y1="22.08" y2="12"/>' />,
            UserCheck: (p) => <Icon {...p} path='<path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/>' />,
            Languages: (p) => <Icon {...p} path='<path d="m5 8 6 6"/><path d="m4 14 6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/><path d="m22 22-5-10-5 10"/><path d="M14 18h6"/>' />,
            Pinterest: (p) => <Icon {...p} path='<path d="M8 22c.164-1.21.31-3.045.064-4.358-.222-1.182-1.442-5.932-1.442-5.932s-.368-.737-.368-1.826c0-1.712.993-2.99 2.228-2.99 1.05 0 1.557.788 1.557 1.733 0 1.057-.674 2.637-1.021 4.102-.29 1.226.614 2.226 1.82 2.226 2.185 0 3.865-2.304 3.865-5.63 0-2.943-2.115-4.996-5.13-4.996-3.493 0-5.544 2.62-5.544 5.328 0 1.054.405 2.185.912 2.798.1.122.114.228.084.351-.092.383-.3.1.413.38-.413.033-.131.066-.312.066s-.321-.082-.416-.289c-.1-.219-.4-.73-.55-.992-.482-.843-.728-1.637-.728-3.089 0-4.475 3.245-8.583 9.375-8.583 4.922 0 8.746 3.508 8.746 8.201 0 4.889-3.083 8.825-7.362 8.825-1.438 0-2.789-.747-3.252-1.632l-.884 3.364c-.32 1.22-1.185 2.748-1.765 3.687a10 10 0 1 0 11.162-4.981" fill="currentColor"/>' />,
            Newspaper: (p) => <Icon {...p} path='<path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><path d="M18 14h-8"/><path d="M15 18h-5"/><path d="M10 6h8v4h-8z"/>' />
        };

        // --- 2. TRADUCCIONES Y DATOS ---
        const translations = {
            es: {
                login_subtitle: "Acceso a Miembros", login_user: "Usuario / Correo", login_license: "Licencia", login_btn: "Ingresar",
                nav_dashboard: "Escritorio", nav_strategies: "Estrategias", nav_finances: "Finanzas", nav_clients: "Ventas", nav_budgets: "Presupuestos", nav_billing: "Facturación", nav_shipping: "Envíos", nav_planner: "Calendario", nav_inventory: "Insumos", nav_workshop: "Taller", nav_calculator: "Cotizador", nav_users: "Usuarios",
                btn_support: "Soporte", btn_logout: "Salir", fin_download: "Descargar CSV", fin_income_title: "Ingreso", fin_expense_title: "Gasto", fin_income: "Ingresos", fin_expenses: "Gastos",
                dash_trend: "Tendencia", dash_campaign: "Campaña", dash_balance: "Balance", dash_income: "Ingresos", dash_expenses: "Gastos",
                strat_ideas: "Ideas", strat_trend: "Tendencia Visual", label_concept: "Concepto", label_amount: "Monto", btn_add: "Agregar",
                inv_title: "Insumos", label_item: "Item", label_stock: "Stock", label_cost: "Costo",
                chk_title: "Nuevo Proyecto", label_job: "Trabajo", label_details: "Detalles...", btn_create: "Crear Ficha",
                cli_title: "Ventas", table_client: "Cliente", table_amount: "Monto", table_actions: "x",
                ship_title: "Envíos", label_tracking: "Tracking", btn_dispatch: "Despachar",
                plan_note: "Cita Personal", placeholder_write: "Escribir cita...",
                calc_title: "Cotizador Pro", calc_final: "Precio Final Sugerido",
                acc_title: "Usuarios Autorizados", acc_new: "Nuevo Usuario",
                bud_new: "Nuevo Presupuesto", bill_new: "Nueva Factura", bud_title_new: "Nuevo Presupuesto", bill_title_new: "Nueva Factura", btn_cancel: "Cancelar", btn_save: "Guardar", label_status: "Estado", bud_item: "Agregar Ítem", bud_total: "Total Estimado",
                mod_title: "Soporte MC Pro", btn_close: "Cerrar",
                days: ['L','M','M','J','V','S','D'],
                settings_lang: "Idioma / Language",
                bud_number: "N° Boleta", bill_number: "N° Factura",
                bud_logo: "Subir Logo", bill_logo: "Subir Logo"
            }
        };

        const FULL_EVENTS = [
            {d:1,m:0,t:'Año Nuevo',type:'INT'}, {d:4,m:0,t:'Braille',type:'INT'}, {d:6,m:0,t:'Día de Reyes (UY)',type:'UY'}, {d:16,m:0,t:'The Beatles',type:'INT'}, {d:24,m:0,t:'Periodista / CM Day',type:'CM'}, {d:25,m:0,t:'Publicidad',type:'CM'}, {d:28,m:0,t:'Protección de Datos',type:'INT'},
            {d:2,m:1,t:'Iemanjá (UY)',type:'UY'}, {d:4,m:1,t:'Cáncer',type:'INT'}, {d:11,m:1,t:'Mujer en la Ciencia',type:'INT'}, {d:13,m:1,t:'Radio / Solteros',type:'INT'}, {d:14,m:1,t:'San Valentín',type:'INT'}, {d:16,m:1,t:'Carnaval (Lunes UY)',type:'UY'}, {d:17,m:1,t:'Carnaval (Martes UY)',type:'UY'}, {d:20,m:1,t:'Día del Gato',type:'INT'}, {d:24,m:1,t:'CM Day (Alt)',type:'CM'}, {d:28,m:1,t:'Grito Asencio (UY)',type:'UY'},
            {d:3,m:2,t:'Naturaleza',type:'INT'}, {d:8,m:2,t:'Día de la Mujer',type:'INT'}, {d:15,m:2,t:'Consumidor',type:'INT'}, {d:17,m:2,t:'San Patricio',type:'INT'}, {d:19,m:2,t:'José P. Varela (UY)',type:'UY'}, {d:20,m:2,t:'Felicidad',type:'INT'}, {d:21,m:2,t:'Poesía / CM Bday',type:'CM'}, {d:22,m:2,t:'Agua',type:'INT'}, {d:27,m:2,t:'Teatro',type:'INT'}, {d:29,m:2,t:'Turismo (Domingo Ramos UY)',type:'UY'},
            {d:1,m:3,t:'Turismo (Continúa UY)',type:'UY'}, {d:2,m:3,t:'Autismo',type:'INT'}, {d:7,m:3,t:'Salud',type:'INT'}, {d:13,m:3,t:'Día del Beso',type:'INT'}, {d:14,m:3,t:'Día Américas (UY)',type:'UY'}, {d:15,m:3,t:'Día Arte',type:'INT'}, {d:19,m:3,t:'Desembarco 33 (UY)',type:'UY'}, {d:21,m:3,t:'Creatividad',type:'CM'}, {d:22,m:3,t:'Tierra',type:'INT'}, {d:23,m:3,t:'Libro / Idioma',type:'INT'}, {d:26,m:3,t:'Diseño Gráfico',type:'CM'},
            {d:1,m:4,t:'Día del Trabajador',type:'INT'}, {d:2,m:4,t:'Bullying',type:'INT'}, {d:4,m:4,t:'Star Wars Day',type:'CM'}, {d:15,m:4,t:'Familia',type:'INT'}, {d:17,m:4,t:'Internet / Reciclaje',type:'INT'}, {d:18,m:4,t:'Batalla Piedras (UY)',type:'UY'}, {d:20,m:4,t:'Marcha Silencio (UY)',type:'UY'}, {d:24,m:4,t:'Orgullo Geek',type:'INT'}, {d:31,m:4,t:'Día del Tabaco',type:'INT'},
            {d:5,m:5,t:'Medio Ambiente',type:'INT'}, {d:8,m:5,t:'Océanos',type:'INT'}, {d:12,m:5,t:'Día del Niño (Alt)',type:'INT'}, {d:19,m:5,t:'Artigas / Abuelos (UY)',type:'UY'}, {d:21,m:5,t:'Selfie / Yoga',type:'CM'}, {d:28,m:5,t:'Orgullo LGTB',type:'INT'}, {d:30,m:5,t:'Social Media Day',type:'CM'},
            {d:13,m:6,t:'Rock / Tequila',type:'INT'}, {d:17,m:6,t:'Emoji Day',type:'CM'}, {d:18,m:6,t:'Jura Constitución (UY)',type:'UY'}, {d:20,m:6,t:'Día del Amigo',type:'INT'}, {d:21,m:6,t:'Perro',type:'INT'}, {d:26,m:6,t:'Abuelos (INT)',type:'INT'}, {d:30,m:6,t:'Amistad',type:'INT'},
            {d:1,m:7,t:'Alegría',type:'INT'}, {d:8,m:7,t:'Gato (INT)',type:'INT'}, {d:16,m:7,t:'Día del Niño (UY Est.)',type:'UY'}, {d:19,m:7,t:'Fotografía',type:'CM'}, {d:24,m:7,t:'Nostalgia (UY)',type:'UY'}, {d:25,m:7,t:'Independencia (UY)',type:'UY'}, {d:29,m:7,t:'Gamer Day',type:'CM'},
            {d:13,m:8,t:'Programador',type:'CM'}, {d:21,m:8,t:'Primavera / Estudiante',type:'UY'}, {d:27,m:8,t:'Turismo',type:'INT'}, {d:29,m:8,t:'Corazón',type:'INT'},
            {d:1,m:9,t:'Música / Café',type:'INT'}, {d:4,m:9,t:'Animales / Sonrisa',type:'INT'}, {d:12,m:9,t:'Diversidad / Sarandí (UY)',type:'UY'}, {d:16,m:9,t:'Alimentación',type:'INT'}, {d:19,m:9,t:'Cáncer de Mama',type:'INT'}, {d:31,m:9,t:'Halloween',type:'INT'},
            {d:1,m:10,t:'Todos los Santos',type:'INT'}, {d:2,m:10,t:'Difuntos (UY)',type:'UY'}, {d:10,m:10,t:'Dibujo',type:'INT'}, {d:20,m:10,t:'Derechos Niño',type:'INT'}, {d:27,m:10,t:'Black Friday',type:'CM'}, {d:30,m:10,t:'Influencer Day',type:'CM'},
            {d:1,m:11,t:'SIDA',type:'INT'}, {d:8,m:11,t:'Inmaculada / Playas (UY)',type:'UY'}, {d:10,m:11,t:'DDHH',type:'INT'}, {d:24,m:11,t:'Nochebuena',type:'INT'}, {d:25,m:11,t:'Navidad / Familia (UY)',type:'UY'}, {d:31,m:11,t:'Fin de Año',type:'INT'}
        ];

        const creativeStrategies = [
            { m: 0, title: 'Vuelta a Clases', ideas: ['Etiquetas escolares personalizadas', 'Cuadernos laminados premium', 'Planners para docentes', 'Kits de escritorio decorados'], trend: 'Colores primarios, tipografías bold tipo "colegio" y personajes pop.', action: 'Anticípate 45 días al inicio de clases.', managerTip: 'Usa encuestas en Instagram para saber qué personajes prefieren los padres.', keywords: "#VueltaAlCole #EtiquetasEscolares" },
            { m: 1, title: 'San Valentín', ideas: ['Explosion Box con fotos', 'Tarjetas shaker con movimiento', 'Cuponeras del amor troqueladas', 'Packaging con foil dorado'], trend: 'Rojos intensos, foil dorado y capas de papel (layering).', action: 'Preventa activa desde el 15 de enero.', managerTip: 'El storytelling sobre "historias reales de amor" genera un 40% más de engagement.', keywords: "#SanValentin #RegalosPersonalizados" },
            { m: 2, title: 'Mes de la Mujer', ideas: ['Agendas para emprendedoras', 'Libretas pocket con frases', 'Marcapáginas magnéticos', 'Kits regalo corporativo'], trend: 'Acuarelas, motivos florales y tonos lila/morado.', action: 'Kits corporativos para empresas.', managerTip: 'Colabora con una marca de papelería liderada por mujeres para sorteos cruzados.', keywords: "#DiaDeLaMujer #MujerEmprendedora" },
            { m: 3, title: 'Pascua Creativa', ideas: ['Cajas visor para huevos', 'Toppers de roscas temáticos', 'Bolsitas conejo kraft', 'Kits búsqueda del tesoro'], trend: 'Tonos pastel, texturas rústicas y conejitos minimalistas.', action: 'Packagings armables para pastelerías locales.', managerTip: 'Muestra el proceso de armado en TikTok con música tendencia (ASMR).', keywords: "#PascuaCreativa #HuevosDePascua" },
            { m: 4, title: 'Día de la Madre', ideas: ['Álbumes scrapbook', 'Bandejas desayuno decoradas', 'Tarjetas pop-up 3D', 'Cuadros con flores de papel'], trend: 'Estampados florales vintage y tipografía script elegante.', action: 'Promociona kits de recuerdos familiares.', managerTip: 'Usa el formato "Guía de Regalos" en Pinterest para atraer tráfico orgánico.', keywords: "#DiaDeLaMadre #RegalosParaMama" },
            { m: 5, title: 'Día del Padre', ideas: ['Cajas vinos grabadas', 'Tarjetas estilo camisa', 'Organizadores escritorio', 'Etiquetas cerveza'], trend: 'Texturas madera, cuero y paleta de azules/gris.', action: 'Papelería con estilo sobrio y funcional.', managerTip: 'Crea contenido sobre "Regalos para el papá que lo tiene todo".', keywords: "#DiaDelPadre #RegalosPapa" },
            { m: 6, title: 'Vacaciones Invierno', ideas: ['Libros actividades niños', 'Kits manualidades DIY', 'Stickers resistentes agua', 'Bitácoras viaje'], trend: 'Personajes divertidos y colores neón vibrantes.', action: 'Kits "aburrimiento cero" para viajes.', managerTip: 'Ofrece un freebie (imprimible gratis) a cambio de suscripción al newsletter.', keywords: "#InviernoCreativo #ActividadesNiños" },
            { m: 7, title: 'Día del Niño', ideas: ['Cajitas sorpresita temáticas', 'Rompecabezas fotos', 'Valijitas cartón', 'Antifaces cartulina'], trend: 'Súper héroes, princesas y mucho color.', action: 'Party boxes listas para usar.', managerTip: 'Haz un concurso de dibujo y que el premio sea el dibujo convertido en sticker.', keywords: "#DiaDelNiño #PartyBox" },
            { m: 8, title: 'Primavera', ideas: ['Banderines guirnaldas', 'Flores gigantes papel', 'Tags suculentas', 'Papelería picnic'], trend: 'Mariposas, flores vibrantes y estilo boho-chic.', action: 'Lanzamiento de nuevas texturas de papel.', managerTip: 'Renueva tu feed con colores brillantes para reflejar el cambio de estación.', keywords: "#BienvenidaPrimavera #Fiestas" },
            { m: 9, title: 'Halloween / Eventos', ideas: ['Cajas ataúd dulces', 'Invitaciones interactivas', 'Toppers terror', 'Máscaras imprimibles'], trend: 'Naranja, violeta y negro. Motivos fantasmales.', action: 'Packaging disruptivo para golosinas.', managerTip: 'Usa filtros de realidad aumentada en tus Stories para temática Halloween.', keywords: "#HalloweenCreativo #DulceOTruco" },
            { m: 10, title: 'Temporada Bodas', ideas: ['Invitaciones papel vegetal', 'Números mesa acrílico', 'Libros firmas', 'Menús alta calidad'], trend: 'Minimalismo, blanco, eucalipto y tipografía fina.', action: 'Ofrece muestras gratis a wedding planners.', managerTip: 'Publica testimonios reales de novias para generar confianza (Prueba social).', keywords: "#Bodas2026 #InvitacionesBoda" },
            { m: 11, title: 'Navidad Emprendedora', ideas: ['Esferas foto vinilo', 'Calendarios adviento', 'Tags foil corporativos', 'Agendas preventa 2027'], trend: 'Verde pino, rojo clásico y mucho glitter/brillo.', action: 'Cierre de año con preventa de agendas.', managerTip: 'Crea un video de "Gracias por este año" humanizando la marca.', keywords: "#NavidadCreativa #Agendas2027" }
        ];

        const stationeryNews = [
            { title: "Tendencia Foil 2026", desc: "Los acabados metálicos en 3D dominan la papelería de lujo este año.", link: "https://www.pinterest.com/search/pins/?q=foil%20stationery%20trends" },
            { title: "Papel Sustentable", desc: "Nuevas texturas fabricadas a partir de residuos orgánicos para packagings.", link: "https://www.pinterest.com/search/pins/?q=sustainable%20packaging%20design" },
            { title: "Plotters de Corte", desc: "Actualización de software para mayor precisión en troquelados complejos.", link: "https://www.pinterest.com/search/pins/?q=cricut%20silhouette%20hacks" }
        ];

        // --- 3. HOOKS PERSISTENCIA ---
        const usePersistedState = (key, defaultValue) => {
            const [state, setState] = useState(() => { try { const s = localStorage.getItem(key); return s ? JSON.parse(s) : defaultValue; } catch (e) { return defaultValue; } });
            const [loaded, setLoaded] = useState(false);
            useEffect(() => {
                if (!window.firebaseModules) { setLoaded(true); return; }
                const { auth, db, appId, onSnapshot, doc } = window.firebaseModules;
                let unsub = null;
                const unsubAuth = auth.onAuthStateChanged((user) => {
                    if(unsub) { unsub(); unsub=null; }
                    if(user) {
                        const ref = doc(db, 'artifacts', appId, 'users', user.uid, 'app_storage', key);
                        unsub = onSnapshot(ref, (s) => { if(s.exists() && s.data().content !== undefined) { setState(s.data().content); localStorage.setItem(key, JSON.stringify(s.data().content)); } setLoaded(true); }, (err) => console.log('Err snap'));
                    }
                });
                return () => { unsubAuth(); if(unsub) unsub(); };
            }, [key]);
            useEffect(() => {
                if(!loaded) return;
                localStorage.setItem(key, JSON.stringify(state));
                if(!window.firebaseModules) return;
                const { auth, db, appId, doc, setDoc } = window.firebaseModules;
                if(auth.currentUser) {
                    const t = setTimeout(() => setDoc(doc(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'app_storage', key), { content: state }, { merge: true }).catch(e => console.log('Err save')), 1500);
                    return () => clearTimeout(t);
                }
            }, [state, loaded, key]);
            return [state, setState];
        };

        const usePublicSharedState = (key, defaultValue) => {
            const [state, setState] = useState(defaultValue);
            useEffect(() => {
                if(!window.firebaseModules) return;
                const { auth, db, appId, onSnapshot, doc } = window.firebaseModules;
                let unsub = null;
                const unsubAuth = auth.onAuthStateChanged((user) => {
                    if(unsub) { unsub(); unsub=null; }
                    if(user) {
                        const ref = doc(db, 'artifacts', appId, 'public', 'data', 'global', key);
                        unsub = onSnapshot(ref, (s) => { if(s.exists() && s.data().content !== undefined) setState(s.data().content); }, (err) => console.log('Permisos'));
                    }
                });
                return () => { unsubAuth(); if(unsub) unsub(); };
            }, [key]);
            const update = (val) => {
                setState(val);
                if(!window.firebaseModules) return;
                const { auth, db, appId, doc, setDoc } = window.firebaseModules;
                if(auth.currentUser) setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'global', key), { content: val }, { merge: true }).catch(e=>console.log('Err pub'));
            };
            return [state, update];
        };

        const NavItemComp = ({ id, label, icon: IconComponent, activeTab, setActiveTab, setIsSidebarOpen }) => (
            <button 
                onClick={() => { setActiveTab(id); setIsSidebarOpen(false); }} 
                className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-2xl transition-all font-bold text-xs uppercase tracking-tight ${activeTab === id ? 'bg-brand text-white shadow-lg' : 'text-slate-500 hover:bg-slate-100'}`}
            >
                {IconComponent && <IconComponent className="w-4 h-4" />} {label}
            </button>
        );

        // --- 4. COMPONENTE APP ---
        const App = () => {
          const [isAuthenticated, setIsAuthenticated] = usePersistedState('mc_auth_session', false);
          const [licenseInput, setLicenseInput] = useState('');
          const [emailInput, setEmailInput] = useState('');
          const [authError, setAuthError] = useState('');
          const [currentUserEmail, setCurrentUserEmail] = usePersistedState('mc_current_user_email', '');
          const [allowedEmails, setAllowedEmails] = usePublicSharedState('access_list', ['modocreativo2026@gmail.com']);
          const [language, setLanguage] = usePersistedState('mc_language', 'es');
          const t = translations.es;
          const ADMIN_EMAIL = 'modocreativo2026@gmail.com';

          const [activeTab, setActiveTab] = useState('dashboard');
          const [showContactModal, setShowContactModal] = useState(false);
          const [notification, setNotification] = useState(null);
          const [currentTime, setCurrentTime] = useState(new Date());
          const [isSidebarOpen, setIsSidebarOpen] = useState(false);
          const [userCountry, setUserCountry] = usePersistedState('mc_country', 'UY');

          // Estados de datos
          const [inventory, setInventory] = usePersistedState('mc_inventory', []);
          const [tasks, setTasks] = usePersistedState('mc_tasks', []);
          const [clients, setClients] = usePersistedState('mc_clients', []); 
          const [shipping, setShipping] = usePersistedState('mc_shipping', []);
          const [expenses, setExpenses] = usePersistedState('mc_expenses', []); 
          const [extraIncomes, setExtraIncomes] = usePersistedState('mc_extra_incomes', []); 
          const [personalEvents, setPersonalEvents] = usePersistedState('mc_personal_events', {});
          const [presupuestos, setPresupuestos] = usePersistedState('mc_presupuestos', []);
          const [facturas, setFacturas] = usePersistedState('mc_facturas', []);
          const [materialDb, setMaterialDb] = usePersistedState('mc_material_db', []);
          
          const [calc, setCalc] = usePersistedState('mc_calc_pro', { selectedMaterialId: '', materialQty: 1, inkPercent: 10, assemblyCost: 0, packagingCost: 0, designHours: 0, cuttingHours: 0, assemblyHours: 0, finishingCost: 0, hourlyRate: 0, opExpenses: 0, maintenanceFund: 0, subscriptions: 0, wastePercent: 10, profitMargin: 50, taxesPercent: 0 });

          // UI para Presupuestos y Facturas
          const [isCreatingBudget, setIsCreatingBudget] = useState(false);
          const [isCreatingInvoice, setIsCreatingInvoice] = useState(false);
          const [currentBudget, setCurrentBudget] = useState({ id: null, number: '', logo: '', client: '', date: new Date().toISOString().split('T')[0], items: [{ id: Date.now(), desc: '', qty: 1, price: 0 }], status: 'Pendiente', notes: '' });
          const [currentInvoice, setCurrentInvoice] = useState({ id: null, number: '', logo: '', client: '', date: new Date().toISOString().split('T')[0], items: [{ id: Date.now(), desc: '', qty: 1, price: 0 }], status: 'Pagada', notes: '' });

          const [viewDate, setViewDate] = useState(new Date());
          const [selectedDay, setSelectedDay] = useState(new Date().getDate());
          const [strategyMonth, setStrategyMonth] = useState(new Date().getMonth());

          const getDayKey = (d) => `${viewDate.getFullYear()}-${String(viewDate.getMonth() + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;

          const notify = (msg) => { setNotification(msg); setTimeout(() => setNotification(null), 2500); };
          const deleteItem = (id, setter, name) => { setter(p => p.filter(i => i.id !== id)); notify(`${name} eliminado`); };
          
          const saveEntity = (e, setter, name) => {
            e.preventDefault(); const d = Object.fromEntries(new FormData(e.target).entries());
            if(d.amount) d.amount = Number(d.amount); if(d.qty) d.qty = Number(d.qty); if(d.price) d.price = Number(d.price);
            const item = { id: Date.now(), ...d, date: new Date().toISOString().split('T')[0], completed: false };
            setter(p => [...p, item]); e.target.reset(); notify(`${name} guardado`);
          };

          const handleLogin = (e) => {
            e.preventDefault();
            const uid = emailInput.trim();
            if (!uid) return setAuthError('Ingresa un usuario.');
            if (allowedEmails.length > 0 && !allowedEmails.includes(uid)) return setAuthError('Usuario no autorizado.');
            if (licenseInput.trim().toUpperCase() === 'CREATIVO2026') {
              setCurrentUserEmail(uid); setIsAuthenticated(true); setAuthError('');
            } else setAuthError('Licencia inválida.');
          };

          const totalIncomes = (clients?.reduce((a,c) => a+(c.amount||0),0) || 0) + (extraIncomes?.reduce((a,i) => a+(i.amount||0),0) || 0);
          const totalExpenses = expenses?.reduce((a,e) => a+(e.amount||0),0) || 0;
          const netBalance = totalIncomes - totalExpenses;
          
          const themeData = useMemo(() => {
             const m = currentTime.getMonth();
             const seasons = { Verano: [11,0,1], Otoño: [2,3,4], Invierno: [5,6,7], Primavera: [8,9,10] };
             const season = Object.keys(seasons).find(k => seasons[k].includes(m)) || 'Verano';
             const colors = { Verano: ['#FFD700','#FF8C00'], Otoño: ['#D35400','#8B4513'], Invierno: ['#4169E1','#87CEEB'], Primavera: ['#FF69B4','#32CD32'] };
             const strat = creativeStrategies.find(st => st.m === m) || creativeStrategies[0];
             return { seasonName: season, seasonalPalette: colors[season], campaignName: strat.title, strategies: strat };
          }, [currentTime]);

          const selectedStrategy = useMemo(() => {
              return creativeStrategies.find(s => s.m === strategyMonth);
          }, [strategyMonth]);

          const proCalcResult = useMemo(() => {
            const material = materialDb.find(m => m.id === Number(calc.selectedMaterialId));
            const baseMaterialCost = material ? material.price * (calc.materialQty || 1) : 0;
            const directCosts = baseMaterialCost + (baseMaterialCost * ((calc.inkPercent || 0)/100)) + (calc.assemblyCost || 0) + (calc.packagingCost || 0);
            const waste = directCosts * ((calc.wastePercent || 0)/100);
            const labor = ((calc.designHours || 0) + (calc.cuttingHours || 0) + (calc.assemblyHours || 0)) * (calc.hourlyRate || 0);
            const productionTotal = directCosts + waste + labor + (calc.finishingCost || 0);
            const operatingTotal = (calc.opExpenses || 0) + (calc.maintenanceFund || 0) + (calc.subscriptions || 0);
            const subTotal = productionTotal + operatingTotal;
            const withProfit = subTotal * (1 + (calc.profitMargin || 0)/100);
            return { cost: subTotal, final: withProfit * (1 + (calc.taxesPercent || 0)/100) };
          }, [calc, materialDb]);

          const calendarDays = useMemo(() => {
            const y = viewDate.getFullYear(), m = viewDate.getMonth();
            const dInM = new Date(y, m + 1, 0).getDate();
            const firstDay = new Date(y, m, 1).getDay();
            const offset = firstDay === 0 ? 6 : firstDay - 1;
            const days = []; for (let i = 0; i < offset; i++) days.push(null); for (let i = 1; i <= dInM; i++) days.push(i); return days;
          }, [viewDate]);

          const handleLogoUpload = (e, type) => {
              const file = e.target.files[0];
              if (file) {
                  const reader = new FileReader();
                  reader.onloadend = () => { if(type==='budget') handleBudgetChange('logo', reader.result); else handleInvoiceChange('logo', reader.result); };
                  reader.readAsDataURL(file);
              }
          };

          const addMaterialToDb = (e) => {
              e.preventDefault();
              const f = new FormData(e.target);
              const name = f.get('name');
              const price = Number(f.get('price'));
              if(!name || isNaN(price)) return;
              setMaterialDb([...materialDb, { id: Date.now(), name, price }]);
              e.target.reset();
              notify("Material guardado");
          };

          const openPinterestSearch = (query) => {
              window.open(`https://www.pinterest.com/search/pins/?q=${encodeURIComponent(query)}`, '_blank');
          };

          const exportToCSV = (data, filename) => {
             if(!data || !data.length) return notify("Sin datos");
             const h = Object.keys(data[0]).join(",");
             const r = data.map(o => Object.values(o).map(v => typeof v === 'string' ? `"${v.replace(/"/g, '""')}"` : v).join(","));
             const b = new Blob(["\uFEFF" + [h, ...r].join("\n")], {type: 'text/csv;charset=utf-8;'});
             const u = URL.createObjectURL(b); const l = document.createElement("a"); l.href = u; l.download = `${filename}.csv`; document.body.appendChild(l); l.click(); document.body.removeChild(l);
          };

          const handleBudgetChange = (f, v) => setCurrentBudget(p => ({ ...p, [f]: v }));
          const handleInvoiceChange = (f, v) => setCurrentInvoice(p => ({ ...p, [f]: v }));
          const updateBudgetItem = (id, f, v) => setCurrentBudget(p => ({ ...p, items: p.items.map(i => i.id === id ? { ...i, [f]: v } : i) }));
          const updateInvItem = (id, f, v) => setCurrentInvoice(p => ({ ...p, items: p.items.map(i => i.id === id ? { ...i, [f]: v } : i) }));

          const todayEvents = FULL_EVENTS.filter(e => e.d === currentTime.getDate() && e.m === currentTime.getMonth());

          return (
            <div className="flex h-screen overflow-hidden bg-[#fcfcfc] text-slate-800 font-sans">
              <aside className={`fixed lg:static inset-y-0 left-0 w-64 bg-white border-r border-slate-100 flex flex-col shrink-0 shadow-2xl z-50 transition-transform duration-300 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}`}>
                <div className="p-6 text-center flex flex-col items-center">
                  <div className="p-3 rounded-2xl text-white shadow-xl rotate-3 mb-3 inline-block bg-brand"><Icons.Star className="w-6 h-6 fill-current" /></div>
                  <h1 className="font-black text-xl uppercase text-slate-800 tracking-tighter leading-none">MC Pro</h1>
                  <p className="text-[9px] font-bold text-brand uppercase tracking-[0.4em] mt-2 leading-none">Modo Creativo</p>
                </div>
                <nav className="flex-1 p-4 space-y-1 overflow-y-auto">
                  <NavItemComp id="dashboard" label={t.nav_dashboard} icon={Icons.Layout} activeTab={activeTab} setActiveTab={setActiveTab} setIsSidebarOpen={setIsSidebarOpen} />
                  <NavItemComp id="strategies" label={t.nav_strategies} icon={Icons.Lightbulb} activeTab={activeTab} setActiveTab={setActiveTab} setIsSidebarOpen={setIsSidebarOpen} />
                  <NavItemComp id="finances" label={t.nav_finances} icon={Icons.Wallet} activeTab={activeTab} setActiveTab={setActiveTab} setIsSidebarOpen={setIsSidebarOpen} />
                  <NavItemComp id="clients" label={t.nav_clients} icon={Icons.DollarSign} activeTab={activeTab} setActiveTab={setActiveTab} setIsSidebarOpen={setIsSidebarOpen} />
                  <NavItemComp id="presupuestos" label={t.nav_budgets} icon={Icons.FileText} activeTab={activeTab} setActiveTab={setActiveTab} setIsSidebarOpen={setIsSidebarOpen} />
                  <NavItemComp id="facturas" label={t.nav_billing} icon={Icons.CreditCard} activeTab={activeTab} setActiveTab={setActiveTab} setIsSidebarOpen={setIsSidebarOpen} />
                  <NavItemComp id="shipping" label={t.nav_shipping} icon={Icons.Truck} activeTab={activeTab} setActiveTab={setActiveTab} setIsSidebarOpen={setIsSidebarOpen} />
                  <NavItemComp id="planner" label={t.nav_planner} icon={Icons.Calendar} activeTab={activeTab} setActiveTab={setActiveTab} setIsSidebarOpen={setIsSidebarOpen} />
                  <NavItemComp id="inventory" label={t.nav_inventory} icon={Icons.Package} activeTab={activeTab} setActiveTab={setActiveTab} setIsSidebarOpen={setIsSidebarOpen} />
                  <NavItemComp id="checklist" label={t.nav_workshop} icon={Icons.ClipboardList} activeTab={activeTab} setActiveTab={setActiveTab} setIsSidebarOpen={setIsSidebarOpen} />
                  <NavItemComp id="calculator" label={t.nav_calculator} icon={Icons.Calculator} activeTab={activeTab} setActiveTab={setActiveTab} setIsSidebarOpen={setIsSidebarOpen} />
                  {currentUserEmail === ADMIN_EMAIL && <NavItemComp id="access_control" label={t.nav_users} icon={Icons.ShieldCheck} activeTab={activeTab} setActiveTab={setActiveTab} setIsSidebarOpen={setIsSidebarOpen} />}
                </nav>
                <div className="p-4 border-t border-slate-50 space-y-2">
                  <button onClick={() => setShowContactModal(true)} className="w-full py-3 bg-dark text-white rounded-xl font-bold text-xs uppercase tracking-widest hover:scale-[1.02] transition-all flex justify-center gap-2"><Icons.MessageCircle className="w-4 h-4" /> {t.btn_support}</button>
                  <button onClick={() => setIsAuthenticated(false)} className="w-full py-3 text-slate-400 hover:text-brand rounded-xl font-bold text-xs uppercase hover:bg-rose-50 flex justify-center gap-2 transition-all"><Icons.LogOut className="w-4 h-4" /> {t.btn_logout}</button>
                </div>
              </aside>

              <main className="flex-1 overflow-y-auto p-4 md:p-6 relative text-slate-800">
                {notification && <div className="fixed top-6 right-6 bg-dark text-white px-6 py-3 rounded-xl font-bold text-xs uppercase shadow-2xl z-[100] animate-in">{notification}</div>}
                
                <header className="flex justify-between items-center mb-6">
                  <button onClick={() => setIsSidebarOpen(true)} className="lg:hidden p-2 bg-white shadow-sm border border-slate-100 rounded-xl text-brand"><Icons.Menu className="w-6 h-6" /></button>
                  <h2 className="text-2xl md:text-3xl font-black tracking-tighter uppercase text-slate-800 leading-none">
                    {activeTab === 'access_control' ? t.acc_title : activeTab === 'dashboard' ? t.nav_dashboard : activeTab === 'strategies' ? t.nav_strategies : activeTab === 'finances' ? t.nav_finances : activeTab === 'clients' ? t.nav_clients : activeTab === 'presupuestos' ? t.nav_budgets : activeTab === 'facturas' ? t.nav_billing : activeTab === 'shipping' ? t.nav_shipping : activeTab === 'planner' ? t.nav_planner : activeTab === 'inventory' ? t.nav_inventory : activeTab === 'checklist' ? t.nav_workshop : t.nav_calculator}
                  </h2>
                  <div className="hidden md:flex items-center gap-3 bg-white p-2 pr-4 rounded-xl border border-slate-100 shadow-sm font-bold">
                    <div className="flex items-center gap-2 px-3 border-r border-slate-100"><Icons.Globe className="w-4 h-4 text-slate-400" /><span className="text-xs uppercase leading-none">{userCountry}</span></div>
                    <div className="bg-amber-100 p-1.5 rounded-lg text-amber-500"><Icons.Sun className="w-4 h-4" /></div>
                    <p className="text-xs leading-none">{currentTime.toLocaleTimeString('es-UY', {hour:'2-digit',minute:'2-digit'})}</p>
                  </div>
                </header>

                {/* --- DASHBOARD --- */}
                {activeTab === 'dashboard' && (
                  <div className="space-y-6 animate-in flex flex-col h-full">
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                      <button onClick={() => setActiveTab('planner')} className="bg-white p-4 rounded-3xl border border-slate-100 shadow-sm flex items-center gap-3 hover:border-brand transition-all group">
                        <div className="p-2 bg-indigo-50 text-indigo-600 rounded-xl group-hover:bg-indigo-100"><Icons.Calendar className="w-5 h-5"/></div>
                        <div className="text-left"><p className="text-[9px] font-black uppercase text-slate-400 leading-none">Mi</p><p className="font-black text-xs uppercase leading-none">Planner</p></div>
                      </button>
                      <button onClick={() => setActiveTab('checklist')} className="bg-white p-4 rounded-3xl border border-slate-100 shadow-sm flex items-center gap-3 hover:border-brand transition-all group">
                        <div className="p-2 bg-rose-50 text-brand rounded-xl group-hover:bg-rose-100"><Icons.ClipboardList className="w-5 h-5"/></div>
                        <div className="text-left"><p className="text-[9px] font-black uppercase text-slate-400 leading-none">Ir al</p><p className="font-black text-xs uppercase leading-none">Taller</p></div>
                      </button>
                      <button onClick={() => setActiveTab('calculator')} className="bg-white p-4 rounded-3xl border border-slate-100 shadow-sm flex items-center gap-3 hover:border-brand transition-all group">
                        <div className="p-2 bg-amber-50 text-amber-600 rounded-xl group-hover:bg-amber-100"><Icons.Calculator className="w-5 h-5"/></div>
                        <div className="text-left"><p className="text-[9px] font-black uppercase text-slate-400 leading-none">Ir al</p><p className="font-black text-xs uppercase leading-none">Cotizador</p></div>
                      </button>
                      <div className="bg-slate-900 p-4 rounded-3xl text-white shadow-lg flex items-center gap-3 relative overflow-hidden">
                        <div className="absolute right-0 top-0 p-2 opacity-10"><Icons.Calendar className="w-10 h-10" /></div>
                        <div className="text-left z-10">
                            <p className="text-[9px] font-black uppercase text-indigo-400 leading-none">Hoy:</p>
                            <p className="font-black text-[11px] uppercase leading-tight truncate w-24">{todayEvents.length > 0 ? todayEvents[0].t : 'Sin eventos'}</p>
                        </div>
                      </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div className="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm flex flex-col justify-center text-center">
                        <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4 flex items-center justify-center gap-2"><Icons.CloudSun className="w-5 h-5 text-amber-500"/> {t.dash_trend} ({themeData.seasonName})</h3>
                        <div className="flex h-12 rounded-2xl overflow-hidden border border-slate-50 shadow-inner">{themeData.seasonalPalette.map((c,i)=><div key={i} className="flex-1" style={{backgroundColor:c}}/>)}</div>
                      </div>
                      <div className="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm flex flex-col justify-center text-center">
                        <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4 flex items-center justify-center gap-2"><Icons.Palette className="w-5 h-5 text-brand"/> {t.dash_campaign} ({themeData.campaignName})</h3>
                        <div className="flex h-12 rounded-2xl border border-slate-100 shadow-inner"><div className="flex-1 bg-rose-500"></div><div className="flex-1 bg-rose-400"></div><div className="flex-1 bg-rose-300"></div></div>
                      </div>
                    </div>

                    {/* Widget Noticias Creativas Diarias */}
                    <div className="bg-white p-6 rounded-[2.5rem] border border-slate-100 shadow-sm">
                        <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mb-6 flex items-center gap-3">
                            <Icons.Newspaper className="w-5 h-5 text-brand" /> Noticias Creativas Diarias
                        </h3>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            {stationeryNews.map((news, idx) => (
                                <a key={idx} href={news.link} target="_blank" className="group p-5 bg-slate-50 rounded-[2rem] border border-slate-50 hover:bg-white hover:border-brand hover:shadow-xl transition-all">
                                    <div className="flex justify-between items-start mb-3">
                                        <div className="p-2 bg-white rounded-xl shadow-sm text-brand"><Icons.Zap className="w-4 h-4 fill-current"/></div>
                                        <Icons.ChevronRight className="w-4 h-4 text-slate-300 group-hover:text-brand" />
                                    </div>
                                    <h4 className="font-black uppercase text-xs mb-2 tracking-tight leading-tight">{news.title}</h4>
                                    <p className="text-[11px] text-slate-500 font-medium leading-relaxed italic">"{news.desc}"</p>
                                </a>
                            ))}
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 min-h-[150px]">
                      <div className="bg-dark p-6 rounded-[2.5rem] text-white shadow-xl relative overflow-hidden flex flex-col justify-center">
                        <div className="absolute top-0 right-0 p-6 opacity-10"><Icons.BarChart3 className="w-16 h-16" /></div>
                        <h3 className="text-[10px] font-black text-indigo-400 uppercase tracking-widest mb-2 leading-none">Balance</h3>
                        <p className="text-4xl font-black tracking-tighter leading-none italic">${netBalance}</p>
                      </div>
                      <div className="bg-emerald-50 p-6 rounded-[2.5rem] border border-emerald-100 flex flex-col justify-center text-slate-800"><h3 className="text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-2 leading-none">Ingresos</h3><p className="text-4xl font-black tracking-tighter leading-none italic">${totalIncomes}</p></div>
                      <div className="bg-rose-50 p-6 rounded-[2.5rem] border border-rose-100 flex flex-col justify-center text-slate-800"><h3 className="text-[10px] font-black text-rose-600 uppercase tracking-widest mb-2 leading-none">Gastos</h3><p className="text-4xl font-black tracking-tighter leading-none italic">${totalExpenses}</p></div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <a href="https://web.whatsapp.com/" target="_blank" className="bg-[#25D366] p-6 rounded-3xl text-white shadow-sm flex items-center gap-6 hover:scale-105 transition-transform group">
                        <Icons.MessageCircle className="w-8 h-8 group-hover:animate-bounce" />
                        <div className="text-left"><p className="text-[9px] font-black uppercase opacity-80 leading-none tracking-widest">Abrir</p><h3 className="text-xl font-black uppercase italic leading-none">WhatsApp</h3></div>
                      </a>
                      <a href="https://instagram.com/" target="_blank" className="bg-gradient-to-tr from-amber-400 via-rose-500 to-purple-600 p-6 rounded-3xl text-white shadow-sm flex items-center gap-6 hover:scale-105 transition-transform group">
                        <Icons.Instagram className="w-8 h-8 group-hover:animate-pulse" />
                        <div className="text-left"><p className="text-[9px] font-black uppercase opacity-80 leading-none tracking-widest">Feed</p><h3 className="text-xl font-black uppercase italic leading-none">Instagram</h3></div>
                      </a>
                      <a href="https://mail.google.com/" target="_blank" className="bg-dark p-6 rounded-3xl text-white shadow-sm flex items-center gap-6 hover:scale-105 transition-transform group border border-slate-700">
                        <Icons.Mail className="w-8 h-8 group-hover:animate-bounce" />
                        <div className="text-left"><p className="text-[9px] font-black uppercase opacity-80 leading-none tracking-widest">Bandeja</p><h3 className="text-xl font-black uppercase italic leading-none">Gmail</h3></div>
                      </a>
                    </div>
                  </div>
                )}

                {/* --- ESTRATEGIAS AJUSTADAS --- */}
                {activeTab === 'strategies' && (
                  <div className="space-y-4 animate-in">
                     <div className="flex gap-2 overflow-x-auto pb-2 scroll-smooth no-scrollbar">
                        {['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'].map((month, i) => (
                           <button key={i} onClick={() => setStrategyMonth(i)} className={`px-5 py-2.5 rounded-2xl font-black uppercase text-[9px] tracking-widest transition-all shrink-0 ${strategyMonth === i ? 'bg-brand text-white shadow-lg' : 'bg-white text-slate-400 border border-slate-100 hover:bg-slate-50'}`}>{month}</button>
                        ))}
                     </div>

                     <div className="relative overflow-hidden rounded-[2.5rem] p-6 md:p-8 text-white shadow-2xl transition-all duration-500" style={{background: `linear-gradient(135deg, ${themeData.seasonalPalette[0]} 0%, ${themeData.seasonalPalette[1]} 100%)`}}>
                        <div className="relative z-10 flex flex-col md:flex-row items-center justify-between gap-6">
                            <div className="text-center md:text-left">
                                <div className="flex items-center justify-center md:justify-start gap-2 mb-2 opacity-90">
                                    <Icons.Star className="w-4 h-4 fill-white" />
                                    <span className="text-[9px] font-black uppercase tracking-[0.4em]">Estrategia Sugerida</span>
                                </div>
                                <h2 className="text-3xl md:text-5xl font-black tracking-tighter uppercase italic leading-none">{selectedStrategy.title}</h2>
                            </div>
                            <div className="flex flex-wrap justify-center gap-2">
                                {selectedStrategy.keywords.split(' ').map((tag, i) => (
                                    <span key={i} className="px-4 py-1.5 bg-white/20 backdrop-blur-2xl rounded-xl text-[9px] font-black uppercase tracking-widest border border-white/10 shadow-sm">{tag}</span>
                                ))}
                            </div>
                        </div>
                        <div className="absolute -right-8 -bottom-8 opacity-10 rotate-12 scale-125"><Icons.Lightbulb className="w-48 h-48" /></div>
                     </div>

                     <div className="grid grid-cols-1 lg:grid-cols-4 gap-4 items-stretch">
                        <div className="lg:col-span-2 bg-white p-6 rounded-[2.5rem] border border-slate-100 shadow-sm text-slate-800">
                            <div className="flex justify-between items-center mb-6 text-slate-800">
                                <h3 className="text-lg font-black flex items-center gap-2 uppercase italic tracking-tight"><Icons.Zap className="w-5 h-5 text-yellow-500 fill-yellow-500" /> Ideas</h3>
                                <button onClick={() => openPinterestSearch(`${selectedStrategy.title} craft ideas papeleria`)} className="p-2.5 bg-rose-50 text-brand rounded-xl hover:scale-110 transition-transform flex items-center gap-2 font-black text-[9px] uppercase tracking-widest shadow-sm"><Icons.Pinterest className="w-3 h-3"/> Pinterest</button>
                            </div>
                            <div className="space-y-2.5">
                                {selectedStrategy.ideas.map((idea, i) => (
                                    <div key={i} className="group p-4 bg-slate-50 rounded-2xl border border-slate-50 flex items-center gap-4 hover:bg-white hover:border-brand transition-all">
                                        <span className="w-8 h-8 rounded-full bg-white flex items-center justify-center text-[10px] font-black text-brand shadow-sm shrink-0 font-black">0{i+1}</span>
                                        <p className="font-bold text-slate-700 text-sm uppercase tracking-tight leading-tight">{idea}</p>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="bg-slate-900 p-6 rounded-[2.5rem] text-white shadow-xl relative overflow-hidden group">
                            <div className="absolute top-0 left-0 p-4 opacity-5"><Icons.UserCheck className="w-32 h-32" /></div>
                            <h3 className="text-base font-black uppercase italic mb-6 relative z-10 flex items-center gap-2 text-indigo-400 leading-none"><Icons.Settings className="w-5 h-5"/> Tip Manager</h3>
                            <div className="relative z-10 space-y-4">
                                <div className="p-4 bg-white/5 rounded-2xl border border-white/5 shadow-inner">
                                    <p className="text-sm font-medium leading-relaxed italic text-slate-200">"{selectedStrategy.managerTip}"</p>
                                </div>
                                <div className="space-y-2">
                                    <h4 className="text-[9px] font-black text-slate-400 uppercase tracking-widest leading-none">Acción Comercial</h4>
                                    <div className="flex items-center gap-2 leading-none"><div className="w-1.5 h-1.5 rounded-full bg-brand leading-none"></div><p className="text-xs font-bold uppercase tracking-tight leading-none">{selectedStrategy.action}</p></div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white p-6 rounded-[2.5rem] border border-slate-100 shadow-sm text-center text-slate-800">
                            <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6 flex items-center justify-center gap-2"><Icons.Palette className="w-4 h-4"/> Estética</h3>
                            <div className="p-4 bg-rose-50 rounded-2xl mb-6 border border-slate-100 shadow-inner">
                                <p className="text-xl font-black text-slate-800 italic leading-snug">"{selectedStrategy.trend}"</p>
                            </div>
                            <h4 className="text-[9px] font-black text-slate-400 uppercase tracking-[0.3em] mb-3 leading-none">Colores</h4>
                            <div className="flex h-12 rounded-2xl overflow-hidden shadow-inner border border-slate-50 leading-none">
                                {themeData.seasonalPalette.map((c, i) => (<div key={i} className="flex-1 hover:scale-125 transition-all" style={{ backgroundColor: c }}></div>))}
                            </div>
                        </div>
                     </div>
                  </div>
                )}

                {/* OTROS MÓDULOS REPARADOS */}
                {activeTab === 'finances' && (<div className="space-y-6 animate-in text-slate-800"><div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 flex flex-wrap gap-6 justify-around items-center"><div className="text-center leading-none"><p className="text-[9px] font-black text-emerald-500 uppercase tracking-widest mb-1 leading-none">Ingresos</p><p className="text-2xl font-black leading-none">${totalIncomes}</p></div><div className="text-center leading-none"><p className="text-[9px] font-black text-rose-500 uppercase tracking-widest mb-1 leading-none">Gastos</p><p className="text-2xl font-black leading-none">${totalExpenses}</p></div><div className="text-center leading-none"><p className="text-[9px] font-black text-brand uppercase tracking-widest mb-1 leading-none">Balance</p><p className={`text-3xl font-black leading-none ${netBalance >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>${netBalance}</p></div></div><div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6"><div className="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm"><h3 className="text-lg font-black mb-4 uppercase flex items-center gap-2 text-emerald-600 italic"><Icons.ArrowUpCircle className="w-5 h-5"/> Ingresos Extra</h3><form onSubmit={(e)=>saveEntity(e,setExtraIncomes,"Ingreso")} className="flex gap-2 mb-4"><input name="name" required placeholder="Concepto" className="flex-1 p-2 bg-slate-50 rounded-xl shadow-inner outline-none"/><input name="amount" type="number" required placeholder="$" className="w-24 p-2 bg-slate-50 rounded-xl shadow-inner outline-none"/><button className="p-2 bg-emerald-500 text-white rounded-xl shadow-md"><Icons.Plus className="w-4 h-4"/></button></form><div className="space-y-2 max-h-60 overflow-y-auto">{extraIncomes.map(i=>(<div key={i.id} className="flex justify-between p-3 bg-slate-50 rounded-xl text-sm font-bold"><span>{i.name}</span><div className="flex items-center gap-3"><span className="text-emerald-600 font-black">+${i.amount}</span><button onClick={()=>deleteItem(i.id,setExtraIncomes,"Ingreso")}><Icons.Trash2 className="w-3 h-3 text-slate-300 hover:text-red-500"/></button></div></div>))}</div></div><div className="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm"><h3 className="text-lg font-black mb-4 uppercase flex items-center gap-2 text-rose-600 italic"><Icons.ArrowDownCircle className="w-5 h-5"/> Gastos</h3><form onSubmit={(e)=>saveEntity(e,setExpenses,"Gasto")} className="flex gap-2 mb-4"><input name="name" required placeholder="Concepto" className="flex-1 p-2 bg-slate-50 rounded-xl outline-none shadow-inner"/><input name="amount" type="number" required placeholder="$" className="w-24 p-2 bg-slate-50 rounded-xl shadow-inner"/><button className="p-2 bg-rose-500 text-white rounded-xl shadow-md"><Icons.Plus className="w-4 h-4"/></button></form><div className="space-y-2 max-h-60 overflow-y-auto">{expenses.map(e=>(<div key={e.id} className="flex justify-between p-3 bg-slate-50 rounded-xl text-sm font-bold"><span>{e.name}</span><div className="flex items-center gap-3"><span className="text-rose-600 font-black">-${e.amount}</span><button onClick={()=>deleteItem(e.id,setExpenses,"Gasto")}><Icons.Trash2 className="w-3 h-3 text-slate-300 hover:text-red-500"/></button></div></div>))}</div></div></div></div>)}

                {activeTab === 'planner' && (
                  <div className="grid grid-cols-1 xl:grid-cols-3 gap-6 animate-in text-slate-800">
                    <div className="xl:col-span-2 bg-white p-6 rounded-[2.5rem] shadow-2xl border border-slate-100">
                       <div className="flex justify-between items-center mb-6">
                          <h3 className="text-xl font-black uppercase italic tracking-tighter leading-none">{viewDate.toLocaleDateString('es-UY', { month: 'long', year: 'numeric' })}</h3>
                          <div className="flex gap-2"><button onClick={()=>setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth()-1, 1))} className="p-2 bg-slate-50 rounded-xl hover:bg-slate-100 transition-colors"><Icons.ChevronLeft className="w-4 h-4"/></button><button onClick={()=>setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth()+1, 1))} className="p-2 bg-slate-50 rounded-xl hover:bg-slate-100 transition-colors"><Icons.ChevronRight className="w-4 h-4"/></button></div>
                       </div>
                       <div className="grid grid-cols-7 gap-1.5">
                         {t.days.map(d=><div key={d} className="text-center font-black pb-2 text-[10px] text-slate-400 uppercase leading-none">{d}</div>)}
                         {calendarDays.map((d,i)=>{
                           const hasEvents = FULL_EVENTS.some(e => e.d === d && e.m === viewDate.getMonth());
                           const dayKey = d ? getDayKey(d) : null;
                           const hasPersonal = dayKey && personalEvents[dayKey] && personalEvents[dayKey].length > 0;
                           const isToday = d === new Date().getDate() && viewDate.getMonth() === new Date().getMonth() && viewDate.getFullYear() === new Date().getFullYear();
                           return (
                             <div key={i} onClick={()=>d && setSelectedDay(d)} className={`h-16 p-2 rounded-xl border transition-all cursor-pointer flex flex-col justify-between ${selectedDay===d?'bg-dark text-white shadow-xl scale-105 z-10':(hasEvents || hasPersonal)?'bg-rose-50 border-rose-100':'bg-white border-slate-100 hover:border-brand'}`}>
                               {d && <div className="flex justify-between items-start leading-none"><span className="text-sm font-bold leading-none">{d}</span><div className="flex gap-1 leading-none">{hasEvents && <div className="w-1.5 h-1.5 rounded-full bg-brand shadow-sm animate-pulse"></div>}{hasPersonal && <div className="w-1.5 h-1.5 rounded-full bg-blue-500 shadow-sm"></div>}</div></div>}
                               {isToday && <div className="text-[8px] font-black uppercase text-brand leading-none">Hoy</div>}
                             </div>
                           );
                         })}
                       </div>
                       <div className="mt-8 pt-6 border-t border-slate-100">
                          <h4 className="text-[10px] font-black uppercase text-slate-400 mb-4 tracking-[0.2em] flex items-center gap-2 italic leading-none"><Icons.Star className="w-4 h-4 text-brand fill-current"/> Efemérides de Hoy ({currentTime.toLocaleDateString('es-UY', {day:'numeric', month:'long'})})</h4>
                          <div className="flex flex-wrap gap-3">
                             {todayEvents.length > 0 ? todayEvents.map((ev, i) => (
                               <div key={i} className="px-4 py-2 bg-rose-50 rounded-2xl border border-rose-100 shadow-sm animate-in"><p className="font-black uppercase text-[10px] text-rose-800 leading-none">{ev.t}</p></div>
                             )) : <p className="text-xs text-slate-400 italic leading-none">No hay efemérides hoy.</p>}
                          </div>
                       </div>
                    </div>
                    <div className="bg-white p-6 rounded-[2rem] shadow-xl border border-slate-100 h-fit">
                       <h4 className="text-2xl font-black uppercase italic mb-4 leading-none">{selectedDay} {viewDate.toLocaleDateString('es-UY', { month: 'short' })}</h4>
                       <div className="space-y-4 max-h-[400px] overflow-y-auto">
                          {FULL_EVENTS.filter(e => e.d === selectedDay && e.m === viewDate.getMonth()).map((ev, i) => (<div key={i} className="p-4 bg-rose-50 rounded-xl border border-rose-100 shadow-sm animate-in"><p className="font-black uppercase text-xs text-rose-800 leading-tight">{ev.t}</p></div>))}
                          <div className="pt-4 border-t border-slate-100 text-slate-800">
                             <h5 className="text-[10px] font-black uppercase text-slate-400 mb-3 tracking-widest leading-none">Cita Personal</h5>
                             <form onSubmit={(e) => { e.preventDefault(); const n = e.target.note.value.trim(); if(n){ const dk = getDayKey(selectedDay); const cur = personalEvents[dk] || []; setPersonalEvents({...personalEvents, [dk]: [...cur, n]}); e.target.reset(); notify("Cita guardada"); } }} className="flex gap-2 mb-4 leading-none">
                                <input name="note" required placeholder="Escribir..." className="flex-1 p-3 bg-slate-50 rounded-xl outline-none text-xs shadow-inner leading-none border-0" />
                                <button className="p-3 bg-slate-900 text-white rounded-xl hover:scale-105 transition-transform shadow-md leading-none"><Icons.Plus className="w-4 h-4"/></button>
                             </form>
                             <div className="space-y-2">
                                {(personalEvents[getDayKey(selectedDay)] || []).map((note, idx) => (
                                   <div key={idx} className="group flex justify-between items-center p-3 bg-blue-50 rounded-xl border border-blue-100 text-blue-900 text-xs font-bold shadow-sm animate-in">
                                      <span>{note}</span>
                                      <button onClick={() => { const dk = getDayKey(selectedDay); setPersonalEvents({...personalEvents, [dk]: personalEvents[dk].filter((_, ni) => ni !== idx)}); notify("Eliminada"); }}><Icons.Trash2 className="w-3 h-3 text-blue-300 hover:text-red-500"/></button>
                                   </div>
                                ))}
                             </div>
                          </div>
                       </div>
                    </div>
                  </div>
                )}

                {/* OTROS MÓDULOS (VENTAS, INSUMOS, TALLER, COTIZADOR, PRESUPUESTOS, FACTURAS) SE MANTIENEN IGUAL PERO OPERATIVOS */}
                {activeTab === 'clients' && (<div className="space-y-6 animate-in text-slate-800"><div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100"><h3 className="text-lg font-black uppercase flex items-center gap-2 text-brand italic"><Icons.PlusCircle className="w-5 h-5"/> Nueva Venta</h3><form onSubmit={(e)=>saveEntity(e,setClients,"Venta")} className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4 leading-none"><input name="name" required placeholder="Cliente" className="p-3 bg-slate-50 rounded-xl font-bold shadow-inner border-0 outline-none"/><input name="amount" type="number" required placeholder="Monto $" className="p-3 bg-slate-50 rounded-xl font-bold shadow-inner border-0 outline-none"/><button className="bg-brand text-white rounded-xl font-black py-3 uppercase text-xs shadow-md transition-all hover:scale-105">Guardar</button></form></div><div className="bg-white rounded-[2rem] border border-slate-100 overflow-hidden shadow-sm mt-6"><table className="w-full text-left"><thead className="bg-slate-50 text-[10px] uppercase font-black text-slate-400"><tr><th className="px-6 py-4">Cliente</th><th className="px-6 py-4">Monto</th><th className="px-6 py-4 text-center">x</th></tr></thead><tbody className="divide-y divide-slate-50">{clients.map(c => (<tr key={c.id} className="hover:bg-slate-50/50 transition-colors text-sm font-bold leading-none"><td className="px-6 py-4 font-black uppercase">{c.name}</td><td className="px-6 py-4 font-black text-brand">${c.amount}</td><td className="px-6 py-4 text-center"><button onClick={() => deleteItem(c.id, setClients, "Venta")}><Icons.Trash2 className="w-4 h-4 text-slate-300 hover:text-red-500"/></button></td></tr>))}</tbody></table></div></div>)}
                {activeTab === 'inventory' && (<div className="space-y-6 animate-in text-slate-800 leading-none"><div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 leading-none"><h3 className="text-lg font-black uppercase flex items-center gap-2 text-brand italic leading-none"><Icons.Package className="w-5 h-5"/> Mis Insumos</h3><form onSubmit={(e) => saveEntity(e, setInventory, "Insumo")} className="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4 leading-none"><input name="name" required placeholder="Item" className="p-3 bg-slate-50 rounded-xl font-bold shadow-inner border-0 outline-none"/><input name="qty" type="number" placeholder="Stock" className="p-3 bg-slate-50 rounded-xl font-bold shadow-inner border-0 outline-none"/><input name="price" type="number" placeholder="Costo" className="p-3 bg-slate-50 rounded-xl font-bold shadow-inner border-0 outline-none"/><button className="bg-brand text-white rounded-xl font-black py-3 uppercase text-xs shadow-md transition-all hover:scale-105">Añadir</button></form></div><div className="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6 leading-none">{inventory.map(item => (<div key={item.id} className="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm flex justify-between group hover:border-brand transition-all leading-none"><div><h4 className="font-black uppercase text-sm leading-none">{item.name}</h4><p className="text-xs text-slate-400 font-bold leading-none">Stock: {item.qty} | Costo: ${item.price}</p></div><button onClick={()=>deleteItem(item.id,setInventory,"Insumo")} className="leading-none"><Icons.Trash2 className="w-4 h-4 text-slate-300 group-hover:text-red-500"/></button></div>))}</div></div>)}
                {activeTab === 'checklist' && (<div className="space-y-6 animate-in text-slate-800 leading-none"><div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 leading-none"><h3 className="text-lg font-black uppercase flex items-center gap-2 text-slate-800 italic leading-none"><Icons.ClipboardList className="w-5 h-5 text-brand"/> Taller</h3><form onSubmit={(e)=>saveEntity(e,setTasks,"Tarea")} className="mt-4 space-y-4 leading-none"><input name="title" required placeholder="Trabajo" className="w-full p-3 bg-slate-50 rounded-xl font-bold shadow-inner outline-none border-0 leading-none"/><textarea name="details" placeholder="Detalles..." className="w-full p-3 bg-slate-50 rounded-xl font-medium h-20 shadow-inner outline-none border-0 leading-none"/><button className="w-full bg-dark text-white rounded-xl font-black py-3 uppercase text-xs shadow-lg transition-all hover:scale-[1.01] leading-none">Crear Ficha</button></form></div><div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6 leading-none">{tasks.map(k=>(<div key={k.id} className={`p-5 bg-white border rounded-2xl flex items-center justify-between group leading-none ${k.completed?'opacity-40':''}`}><div className="flex items-center gap-4 leading-none"><button onClick={()=>setTasks(tasks.map(x=>x.id===k.id?{...x,completed:!x.completed}:x))} className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all leading-none ${k.completed?'bg-emerald-500 text-white':'bg-slate-100'}`}><Icons.CheckCircle2 className="w-5 h-5"/></button><div><h4 className="font-black text-sm uppercase leading-none">{k.title}</h4><p className="text-xs text-slate-400 leading-none mt-1">{k.details}</p></div></div><button onClick={()=>deleteItem(k.id,setTasks,"Tarea")} className="leading-none"><Icons.Trash2 className="w-4 h-4 text-slate-300 group-hover:text-red-500"/></button></div>))}</div></div>)}
                {activeTab === 'calculator' && (<div className="space-y-6 animate-in text-slate-800 leading-none"><div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 animate-in leading-none"><div className="flex justify-between items-center mb-6 leading-none"><h3 className="text-xl font-black uppercase italic leading-none">Cotizador Integral Pro</h3><span className="px-3 py-1 bg-indigo-50 text-indigo-600 rounded-lg text-[10px] font-black uppercase tracking-widest italic leading-none">Cálculo Preciso</span></div><div className="grid grid-cols-1 lg:grid-cols-3 gap-8 leading-none"><div className="space-y-4 leading-none"><h4 className="text-xs font-black text-brand uppercase tracking-widest border-b border-rose-50 pb-2 flex items-center gap-2 leading-none"><Icons.Package className="w-4 h-4"/> 1. Materiales</h4><div className="space-y-3 leading-none"><div><label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase leading-none">Material</label><select className="w-full p-2 bg-slate-50 rounded-xl font-bold text-slate-700 outline-none border border-transparent focus:border-brand/20 shadow-inner leading-none" value={calc.selectedMaterialId} onChange={e=>setCalc({...calc, selectedMaterialId:e.target.value})}><option value="">-- Seleccionar --</option>{materialDb.map(m => <option key={m.id} value={m.id}>{m.name} (${m.price})</option>)}</select></div><div className="grid grid-cols-2 gap-2 leading-none"><div><label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase leading-none">Cant.</label><input type="number" className="w-full p-2 bg-slate-50 rounded-xl font-bold outline-none shadow-inner leading-none" value={calc.materialQty} onChange={e=>setCalc({...calc, materialQty:Number(e.target.value)})}/></div><div><label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase leading-none">Tinta%</label><input type="number" className="w-full p-2 bg-slate-50 rounded-xl font-bold outline-none shadow-inner leading-none" value={calc.inkPercent} onChange={e=>setCalc({...calc, inkPercent:Number(e.target.value)})}/></div></div></div></div><div className="space-y-4 leading-none"><h4 className="text-xs font-black text-indigo-600 uppercase tracking-widest border-b border-indigo-50 pb-2 flex items-center gap-2 leading-none"><Icons.Layout className="w-4 h-4"/> 2. Tiempos</h4><div className="space-y-3 leading-none"><div className="grid grid-cols-3 gap-2 leading-none"><div><label className="block text-[9px] font-bold text-slate-400 mb-1 uppercase leading-none">Diseño</label><input type="number" className="w-full p-2 bg-slate-50 rounded-xl font-bold outline-none shadow-inner leading-none" value={calc.designHours} onChange={e=>setCalc({...calc, designHours:Number(e.target.value)})}/></div><div><label className="block text-[9px] font-bold text-slate-400 mb-1 uppercase leading-none">Corte</label><input type="number" className="w-full p-2 bg-slate-50 rounded-xl font-bold outline-none shadow-inner leading-none" value={calc.cuttingHours} onChange={e=>setCalc({...calc, cuttingHours:Number(e.target.value)})}/></div><div><label className="block text-[9px] font-bold text-slate-400 mb-1 uppercase leading-none">Armado</label><input type="number" className="w-full p-2 bg-slate-50 rounded-xl font-bold outline-none shadow-inner leading-none" value={calc.assemblyHours} onChange={e=>setCalc({...calc, assemblyHours:Number(e.target.value)})}/></div></div><div><label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase leading-none">Precio Hora $</label><input type="number" className="w-full p-2 bg-slate-50 rounded-xl font-bold border-2 border-brand/10 outline-none shadow-inner leading-none" value={calc.hourlyRate} onChange={e=>setCalc({...calc, hourlyRate:Number(e.target.value)})}/></div></div></div><div className="space-y-4 leading-none"><h4 className="text-xs font-black text-emerald-600 uppercase tracking-widest border-b border-emerald-50 pb-2 flex items-center gap-2 leading-none"><Icons.Wallet className="w-4 h-4"/> 3. Márgenes</h4><div className="space-y-3 leading-none"><div><label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase leading-none">Gastos Fijos</label><input type="number" className="w-full p-2 bg-slate-50 rounded-xl font-bold outline-none shadow-inner leading-none" value={calc.opExpenses} onChange={e=>setCalc({...calc, opExpenses:Number(e.target.value)})}/></div><div><label className="block text-[10px] font-bold text-slate-400 mb-1 uppercase leading-none">Ganancia %</label><input type="number" className="w-full p-2 bg-slate-50 rounded-xl font-bold outline-none shadow-inner leading-none" value={calc.profitMargin} onChange={e=>setCalc({...calc, profitMargin:Number(e.target.value)})}/></div></div></div></div><div className="mt-8 bg-dark p-8 rounded-[2.5rem] text-white flex flex-col md:flex-row justify-between items-center gap-6 shadow-2xl relative overflow-hidden group leading-none"><div className="absolute top-0 right-0 p-8 opacity-5 group-hover:opacity-10 transition-opacity leading-none"><Icons.DollarSign className="w-32 h-32 leading-none" /></div><div className="text-center md:text-left relative z-10 leading-none"><p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1 opacity-60 leading-none">Costo Producción</p><p className="text-3xl font-black italic tracking-tighter text-slate-200 leading-none">${proCalcResult.cost.toFixed(2)}</p></div><div className="text-center md:text-right relative z-10 leading-none"><p className="text-[10px] font-black text-brand uppercase tracking-[0.5em] mb-2 leading-none">{t.calc_final}</p><h4 className="text-7xl font-black tracking-tighter transition-all hover:scale-105 text-white leading-none">${proCalcResult.final.toFixed(0)}</h4></div></div></div></div>)}
                {activeTab === 'access_control' && currentUserEmail === ADMIN_EMAIL && (<div className="space-y-6 animate-in text-slate-800 leading-none"><div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 leading-none"><h3 className="text-lg font-black uppercase flex items-center gap-3 text-slate-800 mb-6 italic leading-none"><Icons.ShieldCheck className="w-6 h-6 text-brand"/> Usuarios Autorizados</h3><form onSubmit={(e) => { e.preventDefault(); const n = e.target.newUser.value.trim(); if(n && !allowedEmails.includes(n)){ setAllowedEmails([...allowedEmails, n]); e.target.reset(); notify("Acceso concedido"); } }} className="flex gap-4 mb-6 leading-none"><input name="newUser" required placeholder="Nuevo Usuario / Correo" className="flex-1 p-3 bg-slate-50 rounded-2xl outline-none font-bold text-sm border-0 focus:ring-2 ring-brand/10 shadow-inner leading-none" /><button className="bg-brand text-white rounded-2xl font-black uppercase px-6 shadow-xl text-xs hover:scale-105 transition-all leading-none">Agregar</button></form><div className="grid grid-cols-1 md:grid-cols-2 gap-4 leading-none">{allowedEmails.map((user, index) => (<div key={index} className="flex items-center justify-between p-4 bg-slate-50 rounded-2xl border border-slate-100 leading-none"><div className="flex items-center gap-3 leading-none"><div className="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center font-black text-xs leading-none">{user.substring(0,2).toUpperCase()}</div><span className="font-bold text-slate-700 text-sm leading-none">{user}</span></div><button onClick={() => setAllowedEmails(allowedEmails.filter(u=>u!==user))} className="text-slate-300 hover:text-red-500 transition-colors p-2 leading-none"><Icons.Trash2 className="w-4 h-4"/></button></div>))}</div></div></div>)}
              </main>

              {showContactModal && (
                <div className="fixed inset-0 bg-slate-900/90 backdrop-blur-xl z-[200] flex items-center justify-center p-6 animate-in zoom-in duration-300 text-slate-800 text-center">
                   <div className="bg-white max-w-sm w-full rounded-[3rem] p-10 shadow-2xl relative overflow-hidden">
                      <div className="absolute top-0 left-0 w-full h-2 bg-brand"></div>
                      <div className="w-20 h-20 bg-rose-50 text-brand rounded-[2rem] flex items-center justify-center mx-auto mb-6 shadow-inner"><Icons.UserCheck className="w-10 h-10" /></div>
                      <h3 className="text-2xl font-black uppercase italic mb-4 tracking-tighter leading-tight leading-none">Soporte MC Pro</h3>
                      <div className="space-y-3 leading-none">
                        <a href="https://wa.me/59892617525" target="_blank" className="flex items-center justify-center gap-3 w-full py-4 bg-[#25D366] text-white rounded-3xl font-black uppercase text-[10px] tracking-widest shadow-xl transition-all hover:scale-105 leading-none"><Icons.MessageCircle className="w-4 h-4" /> WhatsApp</a>
                        <button onClick={() => setShowContactModal(false)} className="block w-full py-3 text-slate-300 font-bold uppercase text-[9px] tracking-widest hover:text-brand transition-colors leading-none leading-none">{t.btn_close}</button>
                      </div>
                   </div>
                </div>
              )}
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>